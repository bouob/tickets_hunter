**æ–‡ä»¶èªªæ˜**ï¼šTicketPlus å¹³å°çš„å®Œæ•´å¯¦ä½œåƒè€ƒï¼Œæ¶µè“‹æ’éšŠåµæ¸¬ã€å±•é–‹é¢æ¿è¨­è¨ˆã€å¯¦åé©—è­‰ã€å¤šç‰ˆé¢è‡ªå‹•è­˜åˆ¥ç­‰æŠ€è¡“å¯¦ä½œæŒ‡å—ã€‚

**æœ€å¾Œæ›´æ–°**ï¼š2025-12-02

---

# å¹³å°å¯¦ä½œåƒè€ƒï¼šTicketPlus

## å¹³å°æ¦‚è¿°

**å¹³å°åç¨±**ï¼šTicketPlus (é å¤§å”®ç¥¨)
**å¸‚å ´åœ°ä½**ï¼šå°ç£ä¸­å‹ç¥¨å‹™å¹³å°
**ä¸»è¦æ¥­å‹™**ï¼šæ¼”å”±æœƒã€å±•è¦½ã€é‹å‹•è³½äº‹
**å®Œæˆåº¦**ï¼š85% âœ…
**é›£åº¦ç´šåˆ¥**ï¼šâ­â­â­ (é«˜)

---

## å¹³å°ç‰¹æ€§

### æ ¸å¿ƒç‰¹é»
âœ… **å„ªå‹¢**ï¼š
- Vue.js SPA æ¶æ§‹ï¼ŒDOM çµæ§‹ç›¸å°ç©©å®š
- æ”¯æ´å¤šç¨®ç‰ˆé¢è‡ªå‹•è­˜åˆ¥
- å®Œæ•´çš„æ’éšŠåµæ¸¬æ©Ÿåˆ¶
- æ”¯æ´æŠ˜æ‰£ç¢¼è¼¸å…¥

âš ï¸ **æŒ‘æˆ°**ï¼š
- å¤šç¨®ç‰ˆé¢é¡å‹ï¼ˆStyle 1/2/3ï¼‰
- å±•é–‹é¢æ¿ï¼ˆAccordionï¼‰è¨­è¨ˆ
- å¯¦åé©—è­‰éœ€æ±‚
- æ’éšŠæ©Ÿåˆ¶éœ€è¦ç­‰å¾…

### ç‰¹æ®Šæ©Ÿåˆ¶

1. **æ’éšŠåµæ¸¬**ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
   - è‡ªå‹•åµæ¸¬æ’éšŠç‹€æ…‹é—œéµå­—
   - åµæ¸¬åˆ°æ’éšŠæ™‚æš«åœæ“ä½œ
   - ç­‰å¾…æ’éšŠçµæŸå¾Œç¹¼çºŒ

   | æ’éšŠé—œéµå­— | èªªæ˜ |
   |-----------|------|
   | `æ’éšŠè³¼ç¥¨ä¸­` | é€²å…¥æ’éšŠç‹€æ…‹ |
   | `è«‹ç¨å€™` | ç³»çµ±è™•ç†ä¸­ |
   | `è«‹åˆ¥é›¢é–‹é é¢` | æ’éšŠé€²è¡Œä¸­ |
   | `è«‹å‹¿é›¢é–‹` | æ’éšŠé€²è¡Œä¸­ |
   | `è«‹å‹¿é—œé–‰ç¶²é ` | æ’éšŠé€²è¡Œä¸­ |
   | `åŒæ™‚ä½¿ç”¨å¤šå€‹è£ç½®` | å¤šè£ç½®è­¦å‘Š |
   | `è¦–çª—è³¼ç¥¨` | æ’éšŠè¦–çª—æç¤º |
   | `æ­£åœ¨è™•ç†` | ç³»çµ±è™•ç†ä¸­ |
   | `è™•ç†ä¸­` | ç³»çµ±è™•ç†ä¸­ |

2. **å¤šç‰ˆé¢è‡ªå‹•è­˜åˆ¥**
   - Style 1: æ¨™æº–ç‰ˆé¢ï¼ˆv-expansion-panelsï¼‰
   - Style 2: ç°¡åŒ–ç‰ˆé¢ï¼ˆç›´æ¥æŒ‰éˆ•ï¼‰
   - Style 3: æ–°ç‰ˆé¢ï¼ˆv-card çµæ§‹ï¼‰
   - è‡ªå‹•åµæ¸¬ä¸¦å¥—ç”¨å°æ‡‰é¸æ“‡å™¨

3. **å±•é–‹é¢æ¿**ï¼ˆAccordionï¼‰
   - ç¥¨å€éœ€è¦å…ˆé»æ“Šå±•é–‹
   - å±•é–‹å¾Œæ‰èƒ½é¸æ“‡ç¥¨æ•¸
   - æ”¯æ´é—œéµå­—åŒ¹é…å±•é–‹

4. **å¯¦åé©—è­‰å°è©±æ¡†**
   - è‡ªå‹•åµæ¸¬ä¸¦é—œé–‰å¯¦åé©—è­‰æç¤º
   - è‡ªå‹•è™•ç†ã€Œå…¶ä»–æ´»å‹•æ¨è–¦ã€å°è©±æ¡†
   - è‡ªå‹•è™•ç†ã€Œè¨‚å–®å¤±æ•—ã€å°è©±æ¡†

---

## æ ¸å¿ƒå‡½æ•¸ç´¢å¼•

| éšæ®µ | å‡½æ•¸åç¨± | è¡Œæ•¸ | èªªæ˜ |
|------|---------|------|------|
| Main | `nodriver_ticketplus_main()` | 8928 | ä¸»æ§åˆ¶æµç¨‹ï¼ˆURL è·¯ç”±ï¼‰|
| Stage 2 | `nodriver_ticketplus_account_sign_in()` | 6357 | å¸³è™Ÿç™»å…¥ |
| Stage 2 | `nodriver_ticketplus_account_auto_fill()` | 6433 | è‡ªå‹•å¡«å…¥å¸³å¯† |
| Stage 3 | `nodriver_ticketplus_detect_layout_style()` | 6227 | ç‰ˆé¢é¡å‹åµæ¸¬ |
| Stage 4 | `nodriver_ticketplus_date_auto_select()` | 6485 | æ—¥æœŸè‡ªå‹•é¸æ“‡ |
| Stage 5 | `nodriver_ticketplus_unified_select()` | 6814 | çµ±ä¸€å€åŸŸé¸æ“‡ |
| Stage 5 | `nodriver_ticketplus_order_expansion_auto_select()` | 7453 | å±•é–‹é¢æ¿å€åŸŸé¸æ“‡ |
| Stage 6 | `nodriver_ticketplus_assign_ticket_number()` | 8029 | ç¥¨æ•¸è¨­å®š |
| Stage 9 | `nodriver_ticketplus_ticket_agree()` | 8207 | åŒæ„æ¢æ¬¾ |
| Stage 10 | `nodriver_ticketplus_click_next_button_unified()` | 7348 | ä¸‹ä¸€æ­¥æŒ‰éˆ• |
| Stage 11 | `nodriver_ticketplus_check_queue_status()` | 8376 | **æ’éšŠç‹€æ…‹åµæ¸¬** |
| Stage 11 | `nodriver_ticketplus_order_auto_reload_coming_soon()` | 8455 | å³å°‡é–‹è³£é é¢è™•ç† |
| Stage 12 | `nodriver_ticketplus_confirm()` | 8574 | ç¢ºèªé é¢è™•ç† |
| Util | `nodriver_ticketplus_accept_realname_card()` | 8272 | é—œé–‰å¯¦åé©—è­‰å°è©±æ¡† |
| Util | `nodriver_ticketplus_accept_other_activity()` | 8285 | é—œé–‰æ¨è–¦æ´»å‹•å°è©±æ¡† |
| Util | `nodriver_ticketplus_accept_order_fail()` | 8298 | è™•ç†è¨‚å–®å¤±æ•—å°è©±æ¡† |
| Util | `nodriver_ticketplus_order_exclusive_code()` | 8844 | æŠ˜æ‰£ç¢¼è¼¸å…¥ |
| Util | `nodriver_ticketplus_check_next_button()` | 8808 | ä¸‹ä¸€æ­¥æŒ‰éˆ•ç‹€æ…‹æª¢æŸ¥ |

**ç¨‹å¼ç¢¼ä½ç½®**ï¼š`src/nodriver_tixcraft.py`

---

## ç‰¹æ®Šè¨­è¨ˆ 1: æ’éšŠç‹€æ…‹åµæ¸¬

### æŒ‘æˆ°

TicketPlus åœ¨é«˜æµé‡æ™‚æœƒé€²å…¥æ’éšŠç‹€æ…‹ï¼Œæ­¤æ™‚ï¼š
- é é¢é¡¯ç¤ºæ’éšŠè¨Šæ¯
- å¯èƒ½æœ‰ overlay é®ç½©å±¤
- éœ€è¦ç­‰å¾…è€Œéé‡è¤‡æ“ä½œ

### è§£æ±ºæ–¹æ¡ˆ

**æ ¸å¿ƒç¨‹å¼ç¢¼**ï¼ˆ`nodriver_ticketplus_check_queue_status`, Line 8376ï¼‰:

```python
async def nodriver_ticketplus_check_queue_status(tab, config_dict, force_show_debug=False):
    """æª¢æŸ¥æ’éšŠç‹€æ…‹ - å„ªåŒ–ç‰ˆï¼Œé¿å…é‡è¤‡è¼¸å‡º"""

    result = await tab.evaluate('''
        (function() {
            // æª¢æŸ¥æ’éšŠä¸­çš„é—œéµå­—
            const queueKeywords = [
                'æ’éšŠè³¼ç¥¨ä¸­',
                'è«‹ç¨å€™',
                'è«‹åˆ¥é›¢é–‹é é¢',
                'è«‹å‹¿é›¢é–‹',
                'è«‹å‹¿é—œé–‰ç¶²é ',
                'åŒæ™‚ä½¿ç”¨å¤šå€‹è£ç½®',
                'è¦–çª—è³¼ç¥¨',
                'æ­£åœ¨è™•ç†',
                'è™•ç†ä¸­'
            ];

            const bodyText = document.body.textContent || '';

            // æª¢æŸ¥æ˜¯å¦åŒ…å«ä»»ä½•æ’éšŠé—œéµå­—
            const hasQueueKeyword = queueKeywords.some(keyword => bodyText.includes(keyword));

            // æª¢æŸ¥æ˜¯å¦æœ‰é®ç½©å±¤ï¼ˆæ’éšŠä¸­çš„è¦–è¦ºæŒ‡ç¤ºï¼‰
            const overlayScrim = document.querySelector('.v-overlay__scrim');
            const hasOverlay = overlayScrim &&
                (overlayScrim.style.opacity === '1' ||
                 overlayScrim.style.display !== 'none');

            // æª¢æŸ¥å°è©±æ¡†ä¸­çš„æ’éšŠè¨Šæ¯
            const dialogText = document.querySelector('.v-dialog')?.textContent || '';
            const hasQueueDialog = dialogText.includes('æ’éšŠ') ||
                                   dialogText.includes('è«‹ç¨å€™');

            return {
                inQueue: hasQueueKeyword || hasOverlay || hasQueueDialog,
                foundKeywords: queueKeywords.filter(keyword => bodyText.includes(keyword)),
                hasOverlay: hasOverlay,
                hasQueueDialog: hasQueueDialog
            };
        })();
    ''')

    return result.get('inQueue', False)
```

**æ’éšŠç›£æ§é‚è¼¯**ï¼š
```python
# é€²å…¥æ’éšŠç›£æ§å¾ªç’°ï¼Œæ¯ 5 ç§’æª¢æŸ¥ä¸€æ¬¡
while True:
    is_still_in_queue = await nodriver_ticketplus_check_queue_status(tab, config_dict)

    if not is_still_in_queue:
        # æ’éšŠçµæŸï¼Œç¹¼çºŒè™•ç†
        print("[QUEUE END] Queue ended, continuing page processing")
        break

    await asyncio.sleep(5)  # æ¯ 5 ç§’æª¢æŸ¥ä¸€æ¬¡
```

---

## ç‰¹æ®Šè¨­è¨ˆ 2: å¤šç‰ˆé¢è‡ªå‹•è­˜åˆ¥

### æŒ‘æˆ°

TicketPlus æœ‰å¤šç¨®é é¢ç‰ˆé¢ï¼Œé¸æ“‡å™¨ä¸åŒï¼š
- **Style 1**: ä½¿ç”¨ `v-expansion-panels` å±•é–‹é¢æ¿
- **Style 2**: ç›´æ¥æŒ‰éˆ•å¼é¸æ“‡
- **Style 3**: ä½¿ç”¨ `v-card` å¡ç‰‡çµæ§‹

### è§£æ±ºæ–¹æ¡ˆ

**æ ¸å¿ƒç¨‹å¼ç¢¼**ï¼ˆ`nodriver_ticketplus_detect_layout_style`, Line 6227ï¼‰:

```python
async def nodriver_ticketplus_detect_layout_style(tab, config_dict=None):
    """è‡ªå‹•åµæ¸¬ TicketPlus é é¢ç‰ˆé¢é¡å‹"""

    result = await tab.evaluate('''
        (function() {
            // Style 1: v-expansion-panels (æ¨™æº–å±•é–‹é¢æ¿)
            if (document.querySelector('.v-expansion-panels')) {
                return { style: 1, selector: '.v-expansion-panels' };
            }

            // Style 2: ç›´æ¥æŒ‰éˆ•
            if (document.querySelector('.ticket-area-btn')) {
                return { style: 2, selector: '.ticket-area-btn' };
            }

            // Style 3: v-card çµæ§‹
            if (document.querySelector('.v-card.ticket-card')) {
                return { style: 3, selector: '.v-card.ticket-card' };
            }

            return { style: 0, selector: null };
        })();
    ''')

    return result.get('style', 0)
```

---

## ç‰¹æ®Šè¨­è¨ˆ 3: å±•é–‹é¢æ¿å€åŸŸé¸æ“‡

### æµç¨‹

1. **åµæ¸¬å±•é–‹é¢æ¿**ï¼šæŸ¥æ‰¾ `.v-expansion-panel-header`
2. **é—œéµå­—åŒ¹é…**ï¼šæ¯”å°ç¥¨å€åç¨±
3. **é»æ“Šå±•é–‹**ï¼šå±•é–‹ç›®æ¨™ç¥¨å€
4. **ç­‰å¾…å‹•ç•«**ï¼šç­‰å¾…å±•é–‹å‹•ç•«å®Œæˆ
5. **è¨­å®šç¥¨æ•¸**ï¼šåœ¨å±•é–‹çš„é¢æ¿ä¸­è¨­å®šç¥¨æ•¸

### æ ¸å¿ƒç¨‹å¼ç¢¼ç‰‡æ®µ

```python
# å±•é–‹é¢æ¿é¸æ“‡å™¨
panel_headers = await tab.query_selector_all('.v-expansion-panel-header')

for header in panel_headers:
    header_text = await header.text

    # é—œéµå­—åŒ¹é…
    if area_keyword in header_text:
        # æª¢æŸ¥æ˜¯å¦å·²å±•é–‹
        is_expanded = 'v-expansion-panel--active' in await header.get_attribute('class')

        if not is_expanded:
            await header.click()
            await asyncio.sleep(0.5)  # ç­‰å¾…å±•é–‹å‹•ç•«

        # åœ¨å±•é–‹çš„é¢æ¿ä¸­è¨­å®šç¥¨æ•¸
        panel_content = await header.query_selector('~ .v-expansion-panel-content')
        ticket_input = await panel_content.query_selector('input[type="number"]')

        if ticket_input:
            await ticket_input.clear()
            await ticket_input.send_keys(str(ticket_number))
```

---

## URL è·¯ç”±è¡¨

| URL æ¨¡å¼ | é é¢é¡å‹ | è™•ç†å‡½æ•¸ |
|---------|---------|---------|
| `ticketplus.com.tw/` | é¦–é  | è‡ªå‹•ç™»å…¥å¡«å…¥ |
| `/activity/{id}` | æ´»å‹•é é¢ | æ—¥æœŸé¸æ“‡ |
| `/order/{id}/{session}` | è¨‚å–®é é¢ | å€åŸŸ+ç¥¨æ•¸é¸æ“‡ |
| `/confirm/{id}/{session}` | ç¢ºèªé é¢ | ç¢ºèªè¨‚å–® |
| `/confirmseat/{id}/{session}` | åº§ä½ç¢ºèª | ç¢ºèªåº§ä½ |

---

## é…ç½®ç¯„ä¾‹

```json
{
  "homepage": "https://ticketplus.com.tw/activity/xxx",
  "webdriver_type": "nodriver",
  "ticket_account": {
    "ticketplus": {
      "email": "your@email.com",
      "password": "your_password"
    }
  },
  "date_auto_select": {
    "enable": true,
    "date_keyword": "12/25",
    "mode": "random"
  },
  "area_auto_select": {
    "enable": true,
    "area_keyword": "\"VIPå€\",\"æ–æ»¾å€\",\"ä¸€èˆ¬å€\"",
    "mode": "random"
  },
  "ticket_number": 2,
  "advanced": {
    "verbose": true,
    "auto_reload_page_interval": 3
  }
}
```

---

## å¸¸è¦‹å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ

### Q1: ç‚ºä»€éº¼ä¸€ç›´å¡åœ¨æ’éšŠï¼Ÿ

**A**: é€™æ˜¯æ­£å¸¸ç¾è±¡ï¼Œç¨‹å¼æœƒè‡ªå‹•ç­‰å¾…æ’éšŠçµæŸã€‚

**æª¢æŸ¥é …ç›®**ï¼š
- æŸ¥çœ‹æ—¥èªŒæ˜¯å¦é¡¯ç¤º `[QUEUE] Queue status detected`
- ç¢ºèªç¶²è·¯é€£ç·šç©©å®š
- æ’éšŠæ™‚é–“è¦–æ´»å‹•ç†±é–€ç¨‹åº¦è€Œå®š

### Q2: å±•é–‹é¢æ¿ç„¡æ³•é»æ“Šï¼Ÿ

**A**: å¯èƒ½æ˜¯ç‰ˆé¢é¡å‹åµæ¸¬éŒ¯èª¤ã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. å•Ÿç”¨ `verbose` æ¨¡å¼æŸ¥çœ‹åµæ¸¬çµæœ
2. æª¢æŸ¥ `layout_style` è¼¸å‡º
3. æ‰‹å‹•ç¢ºèªé é¢çµæ§‹æ˜¯å¦ç¬¦åˆé æœŸ

### Q3: æŠ˜æ‰£ç¢¼ç„¡æ³•è¼¸å…¥ï¼Ÿ

**A**: ç¢ºèª `exclusive_code` è¨­å®šæ­£ç¢ºã€‚

**è¨­å®šæ–¹å¼**ï¼š
```json
{
  "advanced": {
    "ticketplus_exclusive_code": "YOUR_CODE"
  }
}
```

---

## é¸æ“‡å™¨å¿«é€Ÿåƒè€ƒ

| åŠŸèƒ½ | é¸æ“‡å™¨ | å‚™è¨» |
|------|--------|------|
| æ—¥æœŸæŒ‰éˆ• | `.session-btn`, `.date-btn` | ä¾ç‰ˆé¢é¡å‹ |
| å±•é–‹é¢æ¿ | `.v-expansion-panel-header` | Style 1 |
| ç¥¨æ•¸è¼¸å…¥ | `input[type="number"]` | åœ¨é¢æ¿å…§ |
| ä¸‹ä¸€æ­¥æŒ‰éˆ• | `.v-btn.primary`, `button[type="submit"]` | å¤šç¨®é¸æ“‡å™¨ |
| æ’éšŠé®ç½© | `.v-overlay__scrim` | åµæ¸¬æ’éšŠ |
| å°è©±æ¡† | `.v-dialog` | å„ç¨®æç¤º |

---

## ç›¸é—œæ–‡ä»¶

- ğŸ“‹ [Stage 11: æ’éšŠè™•ç†æ©Ÿåˆ¶](../../03-mechanisms/11-queue-handling.md) - æ’éšŠåµæ¸¬è©³è§£
- ğŸ“‹ [Stage 5: å€åŸŸé¸æ“‡æ©Ÿåˆ¶](../../03-mechanisms/05-area-selection.md) - å±•é–‹é¢æ¿è™•ç†
- ğŸ—ï¸ [ç¨‹å¼ç¢¼çµæ§‹åˆ†æ](../../02-development/structure.md) - TicketPlus å‡½æ•¸ç´¢å¼•
- ğŸ“– [12-Stage æ¨™æº–](../../02-development/ticket_automation_standard.md) - å®Œæ•´æµç¨‹è¦ç¯„

---

## ç‰ˆæœ¬æ­·å²

| ç‰ˆæœ¬ | æ—¥æœŸ | è®Šæ›´å…§å®¹ |
|------|------|---------|
| v1.0 | 2024 | åˆç‰ˆï¼šåŸºæœ¬åŠŸèƒ½æ”¯æ´ |
| v1.1 | 2025-08 | å¤šç‰ˆé¢è‡ªå‹•è­˜åˆ¥ |
| v1.2 | 2025-10 | å±•é–‹é¢æ¿å„ªåŒ– |
| **v1.3** | **2025-11** | **æ’éšŠåµæ¸¬æ©Ÿåˆ¶å®Œå–„** |
| **v1.4** | **2025-12** | **æŠ˜æ‰£ç¢¼æ”¯æ´ + æ–‡ä»¶æ›´æ–°** |

**v1.4 äº®é»**ï¼š
- âœ… å®Œæ•´çš„æ’éšŠåµæ¸¬æ©Ÿåˆ¶ï¼ˆ9 å€‹é—œéµå­— + overlay åµæ¸¬ï¼‰
- âœ… å¤šç‰ˆé¢è‡ªå‹•è­˜åˆ¥ï¼ˆStyle 1/2/3ï¼‰
- âœ… å±•é–‹é¢æ¿é—œéµå­—åŒ¹é…
- âœ… æŠ˜æ‰£ç¢¼è‡ªå‹•è¼¸å…¥
- âœ… å¯¦åé©—è­‰å°è©±æ¡†è‡ªå‹•è™•ç†
