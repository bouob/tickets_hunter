# ç¥¨å‹™ç³»çµ±é‚è¼¯åˆ¤æ–·ç¯„æœ¬

æœ¬æ–‡ä»¶æä¾›**å¯é‡ç”¨çš„é‚è¼¯åˆ¤æ–·æµç¨‹åœ–**èˆ‡**ç¨‹å¼ç¢¼ç¯„æœ¬**ï¼Œé©ç”¨æ–¼å„ç¨®ç¥¨å‹™å¹³å°çš„è‡ªå‹•åŒ–é–‹ç™¼ã€‚

---

## ç›®éŒ„

1. [æ—¥æœŸé¸æ“‡åˆ¤æ–·é‚è¼¯](#1-æ—¥æœŸé¸æ“‡åˆ¤æ–·é‚è¼¯)
2. [å€åŸŸé¸æ“‡åˆ¤æ–·é‚è¼¯](#2-å€åŸŸé¸æ“‡åˆ¤æ–·é‚è¼¯)
3. [æ ¸å¿ƒå¯é‡ç”¨æ©Ÿåˆ¶](#3-æ ¸å¿ƒå¯é‡ç”¨æ©Ÿåˆ¶)
4. [å¯¦æˆ°æ‡‰ç”¨æ¡ˆä¾‹](#4-å¯¦æˆ°æ‡‰ç”¨æ¡ˆä¾‹)

---

## 1. æ—¥æœŸé¸æ“‡åˆ¤æ–·é‚è¼¯

### ğŸ“Š æ–‡å­—æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. é€²å…¥æ´»å‹•é é¢ (Activity/Game Page)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æŸ¥è©¢æ‰€æœ‰æ—¥æœŸå€å¡Š (Query All Date Elements)              â”‚
â”‚    - ä½¿ç”¨ CSS Selector æˆ– XPath                             â”‚
â”‚    - ä¾‹: '#gameList > table > tbody > tr'                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ æ—¥æœŸå€å¡Šæ•¸é‡ > 0 ?      â”‚
             â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                  â”‚NO           â”‚YES
                  â”‚             â”‚
                  â–¼             â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ è¼ªè©¢æ©Ÿåˆ¶    â”‚  â”‚ 3. éæ¿¾æ—¥æœŸå€å¡Šï¼š                â”‚
        â”‚ â†’ ç­‰å¾…é‡è©¦  â”‚  â”‚   âœ“ æ’é™¤ã€Œå³å°‡é–‹è³£ã€é é¢         â”‚
        â”‚ â†’ åˆ·æ–°é é¢  â”‚  â”‚   âœ“ æ’é™¤å·²å”®å®Œï¼ˆå¯é¸ï¼‰           â”‚
        â”‚             â”‚  â”‚   âœ“ ä¿ç•™å¯è³¼è²·çš„æ—¥æœŸ             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ 4. é—œéµå­—åŒ¹é…å¼•æ“                  â”‚
                         â”‚    Input: date_keyword             â”‚
                         â”‚    ä¾‹: "11/16" æˆ– ["é€±å…­", "æ™šä¸Š"] â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                                   â”‚
                â–¼                                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ç„¡é—œéµå­—è¨­å®š          â”‚         â”‚ æœ‰é—œéµå­—è¨­å®š           â”‚
    â”‚ â†’ ä½¿ç”¨å…¨éƒ¨æ—¥æœŸ        â”‚         â”‚ â†’ é€ä¸€æ¯”å°æ¯å€‹æ—¥æœŸ     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚ æ–‡å­—æ­£è¦åŒ–è™•ç†                â”‚
                              â”‚ - å»é™¤å¤šé¤˜ç©ºç™½                â”‚
                              â”‚ - çµ±ä¸€å…¨å½¢/åŠå½¢               â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ é—œéµå­—åŒ¹é…é‚è¼¯ï¼š                â”‚
                        â”‚ - å­—ä¸²åŒ¹é…: keyword in text     â”‚
                        â”‚ - OR é‚è¼¯: ["A", "B"] ä»»ä¸€å³å¯  â”‚
                        â”‚ - AND é‚è¼¯: ["A", "B"] å…¨éƒ¨éœ€è¦ â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚YES                  â”‚NO
                     â–¼                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ åŠ å…¥ matched æ¸…å–® â”‚   â”‚ è·³éæ­¤æ—¥æœŸ      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ 5. é¸æ“‡ç­–ç•¥å¼•æ“                      â”‚
          â”‚    - from top to bottom â†’ é¸ç¬¬ 1 å€‹  â”‚
          â”‚    - from bottom to top â†’ é¸æœ€å¾Œ 1 å€‹â”‚
          â”‚    - random â†’ éš¨æ©Ÿé¸                 â”‚
          â”‚    - center â†’ é¸ä¸­é–“                 â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ 6. é»æ“Šå›é€€éˆ                        â”‚
          â”‚    å„ªå…ˆé †åº:                         â”‚
          â”‚    â‘  button[data-href] â†’ å– href å°èˆªâ”‚
          â”‚    â‘¡ <a[href]> é€£çµ â†’ ç›´æ¥é»æ“Š      â”‚
          â”‚    â‘¢ <button> æŒ‰éˆ• â†’ ç›´æ¥é»æ“Š       â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ 7. æˆåŠŸå°èˆªåˆ°ä¸‹ä¸€é é¢                â”‚
          â”‚    â†’ é€²å…¥å€åŸŸé¸æ“‡éšæ®µ                â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ğŸ’» ç¨‹å¼é‚è¼¯ç¯„æœ¬

#### ä¸»å‡½æ•¸æ¶æ§‹

```python
async def auto_select_date(tab, config_dict):
    """
    æ—¥æœŸè‡ªå‹•é¸æ“‡ä¸»å‡½æ•¸

    åƒæ•¸:
        tab: ç€è¦½å™¨ tab ç‰©ä»¶
        config_dict: è¨­å®šå­—å…¸
            - date_auto_select.mode: é¸æ“‡æ¨¡å¼ (random/from top to bottom/...)
            - date_auto_select.date_keyword: é—œéµå­—å­—ä¸²
            - tixcraft.pass_date_is_sold_out: æ˜¯å¦è·³éå”®å®Œå ´æ¬¡
            - tixcraft.auto_reload_coming_soon_page: æ˜¯å¦è‡ªå‹•é‡è¼‰å³å°‡é–‹è³£é é¢

    å›å‚³:
        bool: æ˜¯å¦æˆåŠŸé»æ“Šæ—¥æœŸ
    """
    # Step 1: è®€å–è¨­å®š
    auto_select_mode = config_dict["date_auto_select"]["mode"]
    date_keyword = config_dict["date_auto_select"]["date_keyword"].strip()
    pass_sold_out = config_dict["tixcraft"]["pass_date_is_sold_out"]

    # Step 2: æŸ¥è©¢æ‰€æœ‰æ—¥æœŸå€å¡Š
    date_elements = await query_all_dates(tab)

    # Step 3: éæ¿¾æ—¥æœŸå€å¡Š
    filtered_dates = filter_dates(
        date_elements,
        exclude_coming_soon=True,
        exclude_sold_out=pass_sold_out
    )

    # Step 4: é—œéµå­—åŒ¹é…
    if date_keyword:
        matched_dates = match_dates_by_keyword(filtered_dates, date_keyword)
    else:
        matched_dates = filtered_dates

    # Step 5: é¸æ“‡ç›®æ¨™
    target_date = select_target_from_list(matched_dates, auto_select_mode)

    # Step 6: é»æ“Šç›®æ¨™
    is_clicked = await click_date_element(tab, target_date)

    return is_clicked
```

---

#### é—œéµå­—åŒ¹é…å¼•æ“

```python
def match_dates_by_keyword(date_list, date_keyword):
    """
    é—œéµå­—åŒ¹é…å¼•æ“

    åƒæ•¸:
        date_list: æ—¥æœŸå…ƒç´ æ¸…å–® [(element, text), ...]
        date_keyword: JSON æ ¼å¼å­—ä¸²ï¼Œä¾‹å¦‚ '"11/16"' æˆ– '["é€±å…­", "æ™šä¸Š"]'

    å›å‚³:
        matched_list: åŒ¹é…çš„æ—¥æœŸå…ƒç´ æ¸…å–®
    """
    import json
    import re

    # è§£æé—œéµå­—é™£åˆ—
    keyword_array = json.loads("[" + date_keyword + "]")
    matched_list = []

    for element, row_text in date_list:
        # æ­£è¦åŒ–æ–‡å­—ï¼ˆå»é™¤å¤šé¤˜ç©ºç™½ï¼‰
        normalized_text = re.sub(r'\s+', ' ', row_text)

        # æª¢æŸ¥æ¯çµ„é—œéµå­—
        for keyword_set in keyword_array:
            is_match = False

            if isinstance(keyword_set, str):
                # å–®ä¸€é—œéµå­—åŒ¹é…
                normalized_keyword = re.sub(r'\s+', ' ', keyword_set)
                is_match = normalized_keyword in normalized_text

            elif isinstance(keyword_set, list):
                # AND é‚è¼¯ï¼šæ‰€æœ‰é—œéµå­—éƒ½å¿…é ˆåŒ¹é…
                match_results = []
                for kw in keyword_set:
                    normalized_kw = re.sub(r'\s+', ' ', kw)
                    match_results.append(normalized_kw in normalized_text)

                is_match = all(match_results)

            if is_match:
                matched_list.append(element)
                break

    return matched_list
```

---

#### é¸æ“‡ç­–ç•¥å¼•æ“

```python
def select_target_from_list(matched_list, auto_select_mode):
    """
    å¾åŒ¹é…æ¸…å–®ä¸­é¸æ“‡ç›®æ¨™

    åƒæ•¸:
        matched_list: åŒ¹é…çš„å…ƒç´ æ¸…å–®
        auto_select_mode: é¸æ“‡æ¨¡å¼
            - "from top to bottom": é¸ç¬¬ä¸€å€‹
            - "from bottom to top": é¸æœ€å¾Œä¸€å€‹
            - "random": éš¨æ©Ÿé¸
            - "center": é¸ä¸­é–“

    å›å‚³:
        target_element: é¸ä¸­çš„ç›®æ¨™å…ƒç´ ï¼Œç„¡åŒ¹é…æ™‚å›å‚³ None
    """
    if not matched_list or len(matched_list) == 0:
        return None

    if auto_select_mode == "from top to bottom":
        return matched_list[0]

    elif auto_select_mode == "from bottom to top":
        return matched_list[-1]

    elif auto_select_mode == "random":
        import random
        return random.choice(matched_list)

    elif auto_select_mode == "center":
        center_index = len(matched_list) // 2
        return matched_list[center_index]

    else:
        # é è¨­ä½¿ç”¨ç¬¬ä¸€å€‹
        return matched_list[0]
```

---

#### é»æ“Šå›é€€éˆ

```python
async def click_date_element(tab, target_element):
    """
    é»æ“Šæ—¥æœŸå…ƒç´ ï¼ˆä½¿ç”¨å›é€€éˆç¢ºä¿æˆåŠŸï¼‰

    å„ªå…ˆé †åº:
        1. button[data-href] â†’ ç›´æ¥å°èˆª
        2. <a[href]> â†’ é»æ“Šé€£çµ
        3. <button> â†’ é»æ“ŠæŒ‰éˆ•

    å›å‚³:
        bool: æ˜¯å¦æˆåŠŸé»æ“Š
    """
    if not target_element:
        return False

    # Method 1: button[data-href] (TixCraft ç‰¹æœ‰)
    try:
        data_href = await tab.evaluate('''
            (function() {
                const buttons = document.querySelectorAll('button[data-href]');
                for (let button of buttons) {
                    if (button.getAttribute('data-href')) {
                        return button.getAttribute('data-href');
                    }
                }
                return null;
            })();
        ''')

        if data_href:
            await tab.get(data_href)
            return True
    except Exception as e:
        pass

    # Method 2: <a[href]> link
    try:
        link = await target_element.query_selector('a[href]')
        if link:
            await link.click()
            return True
    except:
        pass

    # Method 3: <button>
    try:
        button = await target_element.query_selector('button')
        if button:
            await button.click()
            return True
    except:
        pass

    return False
```

---

## 2. å€åŸŸé¸æ“‡åˆ¤æ–·é‚è¼¯

### ğŸ“Š æ–‡å­—æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. é€²å…¥å€åŸŸé¸æ“‡é é¢ (Area Selection Page)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ 2. æª¢æŸ¥ area_keyword       â”‚
             â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ area_keyword ç‚ºç©ºï¼Ÿ     â”‚
       â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
          â”‚YES              â”‚NO
          â”‚                 â”‚
          â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç›´æ¥åŸ·è¡Œè‡ªå‹•æ¨¡å¼ â”‚  â”‚ 3. è§£æ area_keyword ç‚ºé™£åˆ—         â”‚
â”‚ (ä½¿ç”¨ç©ºå­—ä¸² "") â”‚  â”‚    æ”¯æ´æ ¼å¼:                        â”‚
â”‚                 â”‚  â”‚    - å–®çµ„: "305" â†’ ["305"]          â”‚
â”‚ â†’ è·³åˆ°æ­¥é©Ÿ 5    â”‚  â”‚    - å¤šçµ„å›é€€: "208 304,305"        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â†’ ["208 304", "305"]           â”‚
         â”‚           â”‚    - AND é‚è¼¯: "208 304" (ç©ºæ ¼åˆ†éš”) â”‚
         â”‚           â”‚    - OR é‚è¼¯: "208,304" (é€—è™Ÿ = å›é€€)â”‚
         â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                      â”‚
         â”‚                      â–¼
         â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚         â”‚ 4. è¿´åœˆï¼šé€çµ„å˜—è©¦é—œéµå­—    â”‚
         â”‚         â”‚    (å¯¦ç¾å›é€€ç­–ç•¥)          â”‚
         â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. æŸ¥è©¢æ‰€æœ‰å€åŸŸå…ƒç´  (.zone > a)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ 6. é€ä¸€æª¢æŸ¥æ¯å€‹å€åŸŸ                  â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ å–å¾—å€åŸŸæ–‡å­—                  â”‚
        â”‚ ä¾‹: "æ±305åŒ…å»‚ å‰©é¤˜ 3"        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ é—œéµå­— AND é‚è¼¯æª¢æŸ¥:    â”‚
       â”‚ keyword_item = "208 304"â”‚
       â”‚ â†’ è§£æç‚º ["208", "304"] â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ é€ä¸€æª¢æŸ¥æ¯å€‹å­é—œéµå­—:            â”‚
    â”‚   "208" in text ? â†’ FAIL         â”‚
    â”‚   "304" in text ? â†’ PASS         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ æ‰€æœ‰é—œéµå­—éƒ½åŒ¹é…ï¼Ÿ      â”‚
  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
      â”‚NO               â”‚YES
      â”‚                 â”‚
      â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AND é‚è¼¯å¤±æ•— â”‚  â”‚ æª¢æŸ¥åº§ä½æ•¸é‡æ˜¯å¦è¶³å¤      â”‚
â”‚ è·³éæ­¤å€åŸŸ   â”‚  â”‚ (å¦‚æœ ticket_number > 1) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                    â”‚
      â”‚                    â–¼
      â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚          â”‚ åº§ä½æ•¸é‡æª¢æŸ¥:           â”‚
      â”‚          â”‚ - å–å¾—å‰©é¤˜åº§ä½æ•¸ (font) â”‚
      â”‚          â”‚ - å¦‚æœ < ticket_number  â”‚
      â”‚          â”‚   â†’ è·³é                â”‚
      â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                   â”‚
      â”‚                   â–¼
      â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚          â”‚ åŠ å…¥ matched_blocks æ¸…å–®        â”‚
      â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                   â”‚
      â”‚                   â–¼
      â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚          â”‚ å¦‚æœæ¨¡å¼æ˜¯ã€Œfrom top to bottomã€â”‚
      â”‚          â”‚ â†’ ç«‹å³åœæ­¢ï¼Œä½¿ç”¨ç¬¬ä¸€å€‹åŒ¹é…     â”‚
      â”‚          â”‚ (å…¶ä»–æ¨¡å¼ç¹¼çºŒæœå°‹æ‰€æœ‰)         â”‚
      â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º (ç¹¼çºŒä¸‹ä¸€å€‹å€åŸŸ)


                        â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ 7. æª¢æŸ¥ç•¶å‰çµ„é—œéµå­—çµæœ      â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ æœ‰åŒ¹é…çµæœï¼Ÿ              â”‚
          â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
              â”‚YES                â”‚NO
              â”‚                   â”‚
              â–¼                   â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ é¸æ“‡ç›®æ¨™ä¸¦é»æ“Š   â”‚  â”‚ å˜—è©¦ä¸‹ä¸€çµ„é—œéµå­—â”‚
   â”‚ (ä½¿ç”¨é¸æ“‡ç­–ç•¥)   â”‚  â”‚ (å›é€€æ©Ÿåˆ¶)      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ æ‰€æœ‰é—œéµå­—çµ„éƒ½å¤±æ•—ï¼Ÿ       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚YES
                           â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ 8. æœ€çµ‚å›é€€ (Final Fallback)      â”‚
              â”‚    é€²å…¥è‡ªå‹•æ¨¡å¼ (Auto Mode)       â”‚
              â”‚    - ç©ºé—œéµå­— = æ¥å—æ‰€æœ‰å€åŸŸ      â”‚
              â”‚    - ä½¿ç”¨ auto_select_mode é¸æ“‡   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ æœ‰å¯ç”¨å€åŸŸï¼Ÿ            â”‚
           â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
              â”‚YES              â”‚NO
              â–¼                 â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ é¸æ“‡ç›®æ¨™ä¸¦é»æ“Š   â”‚  â”‚ åˆ·æ–°é é¢é‡è©¦   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ğŸ’» ç¨‹å¼é‚è¼¯ç¯„æœ¬

#### ä¸»å‡½æ•¸æ¶æ§‹

```python
async def auto_select_area(tab, config_dict):
    """
    å€åŸŸè‡ªå‹•é¸æ“‡ä¸»å‡½æ•¸ï¼ˆå«å›é€€æ©Ÿåˆ¶ï¼‰

    åƒæ•¸:
        tab: ç€è¦½å™¨ tab ç‰©ä»¶
        config_dict: è¨­å®šå­—å…¸
            - area_auto_select.mode: é¸æ“‡æ¨¡å¼
            - area_auto_select.area_keyword: é—œéµå­—å­—ä¸²ï¼ˆæ”¯æ´åˆ†è™Ÿåˆ†éš”å›é€€ï¼‰
            - ticket_number: è³¼ç¥¨å¼µæ•¸ï¼ˆç”¨æ–¼åº§ä½æ•¸é‡æª¢æŸ¥ï¼‰

    å›å‚³:
        bool: æ˜¯å¦æˆåŠŸé¸æ“‡å€åŸŸ
    """
    import json

    area_keyword = config_dict["area_auto_select"]["area_keyword"].strip()
    auto_select_mode = config_dict["area_auto_select"]["mode"]

    # Step 1: æŸ¥è©¢å€åŸŸå®¹å™¨
    zone_element = await tab.query_selector('.zone')
    if not zone_element:
        return False

    # Step 2: æª¢æŸ¥ area_keyword æ˜¯å¦ç‚ºç©º
    if area_keyword:
        # Step 3: è§£æé—œéµå­—é™£åˆ—ï¼ˆæ”¯æ´å›é€€ï¼‰
        try:
            keyword_array = json.loads("[" + area_keyword + "]")
        except:
            keyword_array = []
    else:
        # å¦‚æœæ²’æœ‰é—œéµå­—ï¼Œç›´æ¥åŸ·è¡Œè‡ªå‹•æ¨¡å¼
        matched_blocks = await match_areas_by_keyword(zone_element, "", config_dict)
        if matched_blocks and len(matched_blocks) > 0:
            target_area = select_target_from_list(matched_blocks, auto_select_mode)
            await click_area_element(target_area)
            return True
        else:
            await tab.reload()
            return False

    # Step 4: é€çµ„å˜—è©¦é—œéµå­—ï¼ˆå›é€€æ©Ÿåˆ¶ï¼‰
    for keyword_item in keyword_array:
        matched_blocks = await match_areas_by_keyword(
            zone_element,
            keyword_item,
            config_dict
        )

        # å¦‚æœæœ‰åŒ¹é…ï¼Œç«‹å³ä½¿ç”¨
        if matched_blocks and len(matched_blocks) > 0:
            target_area = select_target_from_list(matched_blocks, auto_select_mode)
            await click_area_element(target_area)
            return True

    # Step 4.5: æœ€çµ‚å›é€€ - ä½¿ç”¨è‡ªå‹•æ¨¡å¼ (ç©ºé—œéµå­— = æ¥å—æ‰€æœ‰å€åŸŸ)
    show_debug_message = config_dict["advanced"].get("verbose", False)
    if show_debug_message:
        print(f"[AREA] All keyword groups failed, falling back to auto_select_mode: {auto_select_mode}")

    matched_blocks = await match_areas_by_keyword(zone_element, "", config_dict)

    if matched_blocks and len(matched_blocks) > 0:
        target_area = select_target_from_list(matched_blocks, auto_select_mode)
        await click_area_element(target_area)
        return True

    # Step 5: æ‰€æœ‰å˜—è©¦éƒ½å¤±æ•— â†’ åˆ·æ–°é é¢
    await tab.reload()
    return False
```

---

#### å€åŸŸé—œéµå­—åŒ¹é…å¼•æ“ï¼ˆAND é‚è¼¯ï¼‰

```python
async def match_areas_by_keyword(zone_element, keyword_item, config_dict):
    """
    å€åŸŸé—œéµå­—åŒ¹é…å¼•æ“ï¼ˆæ”¯æ´ AND é‚è¼¯ï¼‰

    åƒæ•¸:
        zone_element: å€åŸŸå®¹å™¨å…ƒç´ 
        keyword_item: å–®çµ„é—œéµå­—ï¼ˆç©ºæ ¼åˆ†éš” = AND é‚è¼¯ï¼‰
            - "305" â†’ åŒ¹é…åŒ…å« "305" çš„å€åŸŸ
            - "208 304" â†’ åŒæ™‚åŒ…å« "208" å’Œ "304" çš„å€åŸŸ
        config_dict: è¨­å®šå­—å…¸ï¼ˆç”¨æ–¼åº§ä½æ•¸é‡æª¢æŸ¥ï¼‰

    å›å‚³:
        matched_blocks: åŒ¹é…çš„å€åŸŸå…ƒç´ æ¸…å–®
    """
    # æŸ¥è©¢æ‰€æœ‰å€åŸŸé€£çµ
    area_list = await zone_element.query_selector_all('a')
    matched_blocks = []

    for area_element in area_list:
        # å–å¾—å€åŸŸæ–‡å­—
        area_html = await area_element.get_html()
        area_text = remove_html_tags(area_html)

        # æª¢æŸ¥æ’é™¤é—œéµå­—
        if is_excluded_by_keyword(area_text, config_dict):
            continue

        # æ­£è¦åŒ–æ–‡å­—
        normalized_text = format_keyword_string(area_text)

        # AND é‚è¼¯åŒ¹é…
        if keyword_item:
            keyword_parts = keyword_item.split(' ')  # ç©ºæ ¼åˆ†éš” = AND

            # æª¢æŸ¥æ¯å€‹å­é—œéµå­—
            match_results = {}
            for kw in keyword_parts:
                normalized_kw = format_keyword_string(kw)
                match_results[kw] = normalized_kw in normalized_text

            # ALL é‚è¼¯åˆ¤æ–·
            is_match = all(match_results.values())

            if not is_match:
                continue  # AND é‚è¼¯å¤±æ•—ï¼Œè·³éæ­¤å€åŸŸ

        # åº§ä½æ•¸é‡æª¢æŸ¥
        if config_dict["ticket_number"] > 1:
            if not has_enough_seats(area_element, config_dict["ticket_number"]):
                continue  # åº§ä½ä¸è¶³ï¼Œè·³é

        # é€šéæ‰€æœ‰æª¢æŸ¥ï¼ŒåŠ å…¥åŒ¹é…æ¸…å–®
        matched_blocks.append(area_element)

        # å¦‚æœæ˜¯ "from top to bottom" æ¨¡å¼ï¼Œç«‹å³åœæ­¢
        if config_dict["area_auto_select"]["mode"] == "from top to bottom":
            break

    return matched_blocks
```

---

#### åº§ä½æ•¸é‡æª¢æŸ¥

```python
async def has_enough_seats(area_element, ticket_number):
    """
    æª¢æŸ¥å€åŸŸæ˜¯å¦æœ‰è¶³å¤ åº§ä½

    åƒæ•¸:
        area_element: å€åŸŸå…ƒç´ 
        ticket_number: éœ€è¦çš„ç¥¨åˆ¸å¼µæ•¸

    å›å‚³:
        bool: æ˜¯å¦æœ‰è¶³å¤ åº§ä½
    """
    try:
        font_el = await area_element.query_selector('font')
        if not font_el:
            return True  # ç„¡æ³•åˆ¤æ–·æ™‚é è¨­ç‚ºè¶³å¤ 

        font_text = await font_el.evaluate('el => el.textContent')
        if not font_text:
            return True

        # æª¢æŸ¥å‰©é¤˜åº§ä½æ•¸ï¼ˆå‡è¨­é¡¯ç¤ºç‚ºæ•¸å­—ï¼‰
        remaining_seats = "@%s@" % font_text

        # å¦‚æœå‰©é¤˜åº§ä½åœ¨ 1-9 ä¹‹é–“ï¼Œä¸”å°æ–¼éœ€æ±‚ï¼Œå‰‡ä¸è¶³
        SEATS_1_9 = ["@%d@" % i for i in range(1, 10)]
        for seat_str in SEATS_1_9:
            if seat_str in remaining_seats:
                seat_count = int(seat_str.strip('@'))
                return seat_count >= ticket_number

        return True  # 10+ åº§ä½æˆ–ç„¡æ³•è§£ææ™‚é è¨­ç‚ºè¶³å¤ 
    except:
        return True
```

---

## 3. æ ¸å¿ƒå¯é‡ç”¨æ©Ÿåˆ¶

### 3.1 é—œéµå­—æ­£è¦åŒ–å‡½æ•¸

```python
def format_keyword_string(keyword):
    """
    æ­£è¦åŒ–é—œéµå­—å­—ä¸²
    - å»é™¤å¤šé¤˜ç©ºç™½
    - çµ±ä¸€å…¨å½¢/åŠå½¢ï¼ˆå¯é¸ï¼‰
    - è½‰æ›ç‚ºå°å¯«ï¼ˆå¯é¸ï¼‰

    åƒæ•¸:
        keyword: åŸå§‹é—œéµå­—å­—ä¸²

    å›å‚³:
        normalized: æ­£è¦åŒ–å¾Œçš„å­—ä¸²
    """
    import re

    # å»é™¤å‰å¾Œç©ºç™½
    normalized = keyword.strip()

    # å»é™¤å¤šé¤˜ç©ºç™½ï¼ˆä¿ç•™å–®ä¸€ç©ºæ ¼ï¼‰
    normalized = re.sub(r'\s+', ' ', normalized)

    # å…¨å½¢è½‰åŠå½¢ï¼ˆå¯é¸ï¼‰
    # normalized = normalized.replace('ã€€', ' ')

    return normalized
```

---

### 3.2 è¼ªè©¢æ©Ÿåˆ¶ç¯„æœ¬

```python
async def polling_until_available(check_function, max_retries=100, interval=1.0):
    """
    è¼ªè©¢æ©Ÿåˆ¶ï¼šé‡è¤‡æª¢æŸ¥ç›´åˆ°æ¢ä»¶æ»¿è¶³

    ä½¿ç”¨å ´æ™¯:
        - ç­‰å¾…å³å°‡é–‹è³£é é¢å‡ºç¾å¯è³¼è²·æ—¥æœŸ
        - ç­‰å¾…å€åŸŸé é¢è¼‰å…¥å®Œæˆ

    åƒæ•¸:
        check_function: æª¢æŸ¥å‡½æ•¸ï¼ˆasyncï¼‰ï¼Œå›å‚³ True/False
        max_retries: æœ€å¤§é‡è©¦æ¬¡æ•¸
        interval: æª¢æŸ¥é–“éš”ï¼ˆç§’ï¼‰

    å›å‚³:
        bool: æ˜¯å¦æˆåŠŸï¼ˆåœ¨æœ€å¤§æ¬¡æ•¸å…§æ»¿è¶³æ¢ä»¶ï¼‰
    """
    import asyncio

    for attempt in range(max_retries):
        result = await check_function()

        if result:
            return True

        # ç­‰å¾…å¾Œé‡è©¦
        await asyncio.sleep(interval)

    return False


# ä½¿ç”¨ç¯„ä¾‹ï¼š
async def check_dates_available(tab):
    """æª¢æŸ¥æ˜¯å¦æœ‰å¯è³¼è²·çš„æ—¥æœŸ"""
    date_elements = await tab.query_selector_all('.date-button')
    return len(date_elements) > 0

# åŸ·è¡Œè¼ªè©¢
success = await polling_until_available(
    lambda: check_dates_available(tab),
    max_retries=60,
    interval=2.0
)
```

---

### 3.3 å›é€€ç­–ç•¥å¯¦ä½œç¯„æœ¬

```python
def parse_fallback_keywords(keyword_string):
    """
    è§£æå›é€€é—œéµå­—å­—ä¸²

    æ ¼å¼:
        - å–®ä¸€: "305" â†’ ["305"]
        - AND é‚è¼¯: "208 304" â†’ ["208 304"]
        - å›é€€ (OR): "208 304,305,ä»»æ„" â†’ ["208 304", "305", "ä»»æ„"]

    åƒæ•¸:
        keyword_string: é—œéµå­—å­—ä¸²

    å›å‚³:
        keyword_array: é—œéµå­—é™£åˆ—ï¼ˆä¾å„ªå…ˆé †åºæ’åˆ—ï¼‰
    """
    import json

    try:
        # ä½¿ç”¨ JSON è§£æï¼ˆæ”¯æ´åˆ†è™Ÿåˆ†éš”ï¼‰
        keyword_array = json.loads("[" + keyword_string + "]")
        return keyword_array
    except:
        # è§£æå¤±æ•—æ™‚å›å‚³ç©ºé™£åˆ—
        return []


# ä½¿ç”¨ç¯„ä¾‹ï¼š
keywords = parse_fallback_keywords('"208 304";"305";"ä»»æ„"')
# çµæœ: ["208 304", "305", "ä»»æ„"]

# å›é€€é‚è¼¯å¯¦ä½œ
for keyword_item in keywords:
    matched = match_by_keyword(keyword_item)
    if matched:
        # æ‰¾åˆ°åŒ¹é…ï¼Œç«‹å³ä½¿ç”¨
        break
else:
    # æ‰€æœ‰é—œéµå­—éƒ½å¤±æ•—
    print("No matches found, refresh page")
```

---

### 3.4 é™¤éŒ¯è¨Šæ¯æ ¼å¼ç¯„æœ¬

```python
def print_match_summary(matched_count, total_count, keyword, show_debug=True):
    """
    åˆ—å°åŒ¹é…çµæœæ‘˜è¦

    åƒæ•¸:
        matched_count: åŒ¹é…æ•¸é‡
        total_count: ç¸½æ•¸é‡
        keyword: ä½¿ç”¨çš„é—œéµå­—
        show_debug: æ˜¯å¦é¡¯ç¤ºé™¤éŒ¯è¨Šæ¯
    """
    if not show_debug:
        return

    print(f"[KEYWORD MATCH] ========================================")
    print(f"[KEYWORD MATCH] Keyword: '{keyword}'")
    print(f"[KEYWORD MATCH] Total items: {total_count}")
    print(f"[KEYWORD MATCH] Matched items: {matched_count}")

    if total_count > 0:
        match_rate = matched_count / total_count * 100
        print(f"[KEYWORD MATCH] Match rate: {match_rate:.1f}%")

    if matched_count == 0:
        print(f"[KEYWORD MATCH] No matches found")

    print(f"[KEYWORD MATCH] ========================================")


# ä½¿ç”¨ç¯„ä¾‹ï¼š
print_match_summary(
    matched_count=2,
    total_count=15,
    keyword="305",
    show_debug=config_dict["advanced"]["verbose"]
)
# è¼¸å‡º:
# [KEYWORD MATCH] ========================================
# [KEYWORD MATCH] Keyword: '305'
# [KEYWORD MATCH] Total items: 15
# [KEYWORD MATCH] Matched items: 2
# [KEYWORD MATCH] Match rate: 13.3%
# [KEYWORD MATCH] ========================================
```

---

## 4. å¯¦æˆ°æ‡‰ç”¨æ¡ˆä¾‹

### æ¡ˆä¾‹ 1: TixCraft æ—¥æœŸé¸æ“‡å®Œæ•´æµç¨‹

#### å ´æ™¯æè¿°
- **ç›®æ¨™**: è³¼è²·ã€Œä¸å™¹æ¼”å”±æœƒã€11/16 å ´æ¬¡
- **è¨­å®š**:
  - `date_keyword`: `"11/16"`
  - `auto_select_mode`: `from top to bottom`
  - `pass_date_is_sold_out`: `true`

#### åŸ·è¡Œæµç¨‹

```
1. é€²å…¥æ´»å‹•é é¢
   https://tixcraft.com/activity/game/25_dellatp

2. åˆå§‹ç‹€æ…‹ï¼šç¥¨å°šæœªé–‹è³£
   - Total dates available: 0
   - è§¸ç™¼è¼ªè©¢æ©Ÿåˆ¶ï¼ŒæŒçºŒåˆ·æ–°é é¢

3. ç¥¨é–‹è³£å¾Œï¼šæ‰¾åˆ° 2 å€‹å¯ç”¨æ—¥æœŸ
   - 2025/11/15 (å…­) 19:00 ä¸å™¹...
   - 2025/11/16 (æ—¥) 17:00 ä¸å™¹...

4. é—œéµå­—åŒ¹é…
   Input: "11/16"
   [1/2] "2025/11/15 (å…­)..." â†’ No match
   [2/2] "2025/11/16 (æ—¥)..." â†’ Matched!

   çµæœ: 1 å€‹åŒ¹é… (50% match rate)

5. é¸æ“‡ç­–ç•¥
   Mode: from top to bottom
   Selected: #1/1 (å”¯ä¸€åŒ¹é…é …)

6. é»æ“Šæ–¹æ³•
   å˜—è©¦é †åº:
   â‘  button[data-href] â†’ å¤±æ•— (Invalid URL)
   â‘¡ <a[href]> â†’ ç„¡é€£çµ
   â‘¢ <button> â†’ æˆåŠŸé»æ“Š!

7. å°èˆªæˆåŠŸ
   â†’ é€²å…¥å€åŸŸé¸æ“‡é é¢
```

---

### æ¡ˆä¾‹ 2: TixCraft å€åŸŸé¸æ“‡ï¼ˆAND é‚è¼¯ + å›é€€ï¼‰

#### å ´æ™¯æè¿°
- **ç›®æ¨™**: é¸æ“‡åŒ…å«ã€Œ208ã€ä¸”ã€Œ304ã€çš„å€åŸŸï¼Œå¤±æ•—å‰‡å›é€€åˆ°ã€Œ305ã€
- **è¨­å®š**:
  - `area_keyword`: `"208 304";"305"`
  - `auto_select_mode`: `random`
  - `ticket_number`: `2`

#### åŸ·è¡Œæµç¨‹

```
1. è§£æé—œéµå­—é™£åˆ—
   Input: "208 304";"305"
   Parsed: ["208 304", "305"]
   Total groups: 2

2. ç¬¬ä¸€çµ„å˜—è©¦: "208 304" (AND é‚è¼¯)
   Found 15 areas to check

   [3/15] æ±304åŒ…å»‚ å‰©é¤˜ 5
     AND keywords: ["208", "304"]
     âœ— "208" in text â†’ FAIL
     âœ“ "304" in text â†’ PASS
     â†’ AND logic failed (éœ€è¦å…¨éƒ¨åŒ¹é…)

   [10/15] è¥¿304åŒ…å»‚ å‰©é¤˜ 4
     AND keywords: ["208", "304"]
     âœ— "208" in text â†’ FAIL
     âœ“ "304" in text â†’ PASS
     â†’ AND logic failed

   Result: 0 matches
   â†’ è§¸ç™¼å›é€€æ©Ÿåˆ¶

3. ç¬¬äºŒçµ„å˜—è©¦: "305" (å–®ä¸€é—œéµå­—)

   [4/15] æ±305åŒ…å»‚ å‰©é¤˜ 3
     Keyword: ["305"]
     âœ“ "305" in text â†’ PASS
     âœ“ Seats check: 3 >= 2 (sufficient)
     â†’ Area added to matched list (total: 1)

   [11/15] è¥¿305åŒ…å»‚ å‰©é¤˜ 3
     Keyword: ["305"]
     âœ“ "305" in text â†’ PASS
     âœ“ Seats check: 3 >= 2 (sufficient)
     â†’ Area added to matched list (total: 2)

   Result: 2 matches (13.3% match rate)

4. é¸æ“‡ç­–ç•¥
   Mode: random
   Options: [æ±305åŒ…å»‚, è¥¿305åŒ…å»‚]
   Selected: (éš¨æ©Ÿé¸æ“‡å…¶ä¸­ä¸€å€‹)

5. é»æ“Šä¸¦å°èˆª
   â†’ æˆåŠŸé€²å…¥ç¥¨åˆ¸é é¢
   â†’ é–‹å§‹ OCR é©—è­‰ç¢¼è™•ç†
```

---

### æ¡ˆä¾‹ 2.5: TixCraft å€åŸŸé¸æ“‡ - æœ€çµ‚å›é€€åˆ°è‡ªå‹•æ¨¡å¼

#### å ´æ™¯æè¿°
- **ç›®æ¨™**: é¸æ“‡åŒ…å«ã€ŒVIPã€çš„å€åŸŸï¼Œå¤±æ•—å‰‡å›é€€åˆ°ã€Œæ–æ»¾å€ã€ï¼Œå…¨éƒ¨å¤±æ•—å‰‡ä½¿ç”¨è‡ªå‹•æ¨¡å¼
- **è¨­å®š**:
  - `area_keyword`: `"VIP";"æ–æ»¾å€"`
  - `auto_select_mode`: `from top to bottom`
  - `ticket_number`: `1`

#### åŸ·è¡Œæµç¨‹

```
1. è§£æé—œéµå­—é™£åˆ—
   Input: "VIP";"æ–æ»¾å€"
   Parsed: ["VIP", "æ–æ»¾å€"]
   Total groups: 2

2. ç¬¬ä¸€çµ„å˜—è©¦: "VIP"
   Found 10 areas to check

   [1/10] ä¸€èˆ¬åº§ä½å€ 1500 å…ƒ
     Keyword: ["VIP"]
     âœ— "VIP" in text â†’ FAIL

   [2/10] æ–æ»¾ç«™ç¥¨å€ 800 å…ƒ
     Keyword: ["VIP"]
     âœ— "VIP" in text â†’ FAIL

   ... (æ‰€æœ‰å€åŸŸéƒ½ä¸å« "VIP")

   Result: 0 matches
   â†’ è§¸ç™¼å›é€€æ©Ÿåˆ¶

3. ç¬¬äºŒçµ„å˜—è©¦: "æ–æ»¾å€"

   [1/10] ä¸€èˆ¬åº§ä½å€ 1500 å…ƒ
     Keyword: ["æ–æ»¾å€"]
     âœ— "æ–æ»¾å€" in text â†’ FAIL

   [2/10] æ–æ»¾ç«™ç¥¨å€ 800 å…ƒ
     Keyword: ["æ–æ»¾å€"]
     âœ— "æ–æ»¾å€" in text â†’ FAIL
     â†’ (åŒ…å«ã€Œæ–æ»¾ã€ä½†ä¸æ˜¯ã€Œæ–æ»¾å€ã€)

   ... (æ‰€æœ‰å€åŸŸéƒ½ä¸å« "æ–æ»¾å€")

   Result: 0 matches
   â†’ æ‰€æœ‰é—œéµå­—çµ„éƒ½å¤±æ•—

4. æœ€çµ‚å›é€€ï¼šé€²å…¥è‡ªå‹•æ¨¡å¼
   [AREA] All keyword groups failed, falling back to auto_select_mode: from top to bottom

   ä½¿ç”¨ç©ºé—œéµå­— ("") é‡æ–°æƒææ‰€æœ‰å€åŸŸï¼š

   [1/10] ä¸€èˆ¬åº§ä½å€ 1500 å…ƒ
     No keyword filter, accepting this area
     â†’ Area added to matched list (total: 1)

   Mode is 'from top to bottom', stopping at first match

   Result: 1 match
   â†’ é¸æ“‡ç¬¬ä¸€å€‹å¯ç”¨å€åŸŸ

5. é¸æ“‡ç­–ç•¥
   Mode: from top to bottom
   Selected: ä¸€èˆ¬åº§ä½å€ 1500 å…ƒ

6. é»æ“Šä¸¦å°èˆª
   â†’ æˆåŠŸé€²å…¥ç¥¨åˆ¸é é¢
```

**é‡é»èªªæ˜**ï¼š
- ç•¶æ‰€æœ‰é—œéµå­—çµ„éƒ½ç„¡æ³•åŒ¹é…æ™‚ï¼Œç³»çµ±æœƒè‡ªå‹•é€²å…¥ã€Œè‡ªå‹•æ¨¡å¼ã€
- è‡ªå‹•æ¨¡å¼ä½¿ç”¨ `auto_select_mode` è¨­å®šä¾†é¸æ“‡å€åŸŸï¼ˆæ­¤ä¾‹ç‚º `from top to bottom`ï¼‰
- é€™ç¢ºä¿å³ä½¿é—œéµå­—è¨­å®šéŒ¯èª¤ï¼Œç³»çµ±ä»èƒ½è‡ªå‹•é¸æ“‡å¯ç”¨å€åŸŸ
- é€™æ˜¯ä¸€å€‹**ä¸‰å±¤å›é€€ç­–ç•¥**ï¼šé—œéµå­—çµ„ 1 â†’ é—œéµå­—çµ„ 2 â†’ è‡ªå‹•æ¨¡å¼

---

### æ¡ˆä¾‹ 3: åº§ä½æ•¸é‡æª¢æŸ¥é‚è¼¯

#### å ´æ™¯æè¿°
- **éœ€æ±‚**: è³¼è²· 4 å¼µç¥¨ï¼Œä½†æŸäº›å€åŸŸåªå‰© 1-3 å¼µ
- **è¨­å®š**: `ticket_number`: `4`

#### åŸ·è¡Œæµç¨‹

```
æª¢æŸ¥é‚è¼¯:

[1/15] æ±302åŒ…å»‚ å‰©é¤˜ 8
  âœ“ Keyword matched
  âœ“ Seats check: 8 >= 4 â†’ é€šé
  â†’ åŠ å…¥åŒ¹é…æ¸…å–®

[2/15] æ±303åŒ…å»‚ å‰©é¤˜ 2
  âœ“ Keyword matched
  âœ— Seats check: 2 < 4 â†’ åº§ä½ä¸è¶³
  â†’ è·³éæ­¤å€åŸŸ

[3/15] æ±304åŒ…å»‚ å‰©é¤˜ 1
  âœ“ Keyword matched
  âœ— Seats check: 1 < 4 â†’ åº§ä½ä¸è¶³
  â†’ è·³éæ­¤å€åŸŸ

[4/15] è¥¿308åŒ…å»‚ å‰©é¤˜ 11
  âœ“ Keyword matched
  âœ“ Seats check: 11 >= 4 â†’ é€šé
  â†’ åŠ å…¥åŒ¹é…æ¸…å–®

æœ€çµ‚çµæœ: 2 å€‹å¯ç”¨å€åŸŸï¼ˆæ±302ã€è¥¿308ï¼‰
```

---

### æ¡ˆä¾‹ 4: å›é€€ç­–ç•¥çš„å„ªå…ˆé †åºè¨­è¨ˆ

#### æ¨è–¦è¨­å®šç¯„ä¾‹

```python
# ç¯„ä¾‹ 1: ç‰¹å®šå€åŸŸ â†’ æ¨“å±¤ â†’ è‡ªå‹•å›é€€
area_keyword = '"1æ¨“ Aå€";"1æ¨“"'
# è¨»ï¼šä¸éœ€è¦å¯«ã€Œä»»æ„ã€ï¼Œæ‰€æœ‰é—œéµå­—å¤±æ•—å¾Œæœƒè‡ªå‹•é€²å…¥ auto_select_mode

# ç¯„ä¾‹ 2: åƒ¹æ ¼ç¯„åœ â†’ æœ€ä¾¿å®œ â†’ è‡ªå‹•å›é€€
area_keyword = '"2800";"2000";"1500"'

# ç¯„ä¾‹ 3: AND é‚è¼¯ â†’ å–®ä¸€æ¢ä»¶ â†’ è‡ªå‹•å›é€€
area_keyword = '"æ–æ»¾ VIP";"æ–æ»¾";"VIP"'

# ç¯„ä¾‹ 4: å–®ä¸€é—œéµå­—ï¼ˆå¤±æ•—å¾Œè‡ªå‹•å›é€€ï¼‰
area_keyword = '"VIP"'
# è¨»ï¼šå¦‚æœæ‰¾ä¸åˆ° VIPï¼Œæœƒè‡ªå‹•ä½¿ç”¨ auto_select_mode é¸æ“‡ä»»æ„å€åŸŸ

# ç¯„ä¾‹ 5: æ’é™¤ç‰¹å®šå€åŸŸï¼ˆä½¿ç”¨ keyword_excludeï¼‰
config_dict["keyword_exclude"] = "èº«éšœ;è¼ªæ¤…"
```

---

## ç¸½çµ

### âœ… æ ¸å¿ƒè¨­è¨ˆåŸå‰‡

1. **å›é€€ç­–ç•¥**: åˆ†è™Ÿåˆ†éš”å¤šçµ„é—œéµå­—ï¼Œä¾åºå˜—è©¦
2. **AND é‚è¼¯**: ç©ºæ ¼åˆ†éš”å­é—œéµå­—ï¼Œå¿…é ˆå…¨éƒ¨åŒ¹é…
3. **æœ€çµ‚å›é€€æ©Ÿåˆ¶**: æ‰€æœ‰é—œéµå­—çµ„éƒ½å¤±æ•—æ™‚ï¼Œè‡ªå‹•é€²å…¥è‡ªå‹•æ¨¡å¼ï¼ˆç©ºé—œéµå­— = æ¥å—æ‰€æœ‰å€åŸŸï¼‰
4. **é¸æ“‡ç­–ç•¥**: random/top/bottom/center éˆæ´»é…ç½®
5. **é»æ“Šå›é€€éˆ**: å¤šç¨®é»æ“Šæ–¹æ³•ç¢ºä¿æˆåŠŸç‡
6. **è¼ªè©¢æ©Ÿåˆ¶**: æŒçºŒé‡è©¦ç›´åˆ°æ¢ä»¶æ»¿è¶³

### ğŸ”§ å¯é‡ç”¨çµ„ä»¶

- `match_dates_by_keyword()` - æ—¥æœŸé—œéµå­—åŒ¹é…
- `match_areas_by_keyword()` - å€åŸŸé—œéµå­—åŒ¹é…ï¼ˆAND é‚è¼¯ï¼‰
- `select_target_from_list()` - é¸æ“‡ç­–ç•¥å¼•æ“
- `click_element()` - é»æ“Šå›é€€éˆ
- `has_enough_seats()` - åº§ä½æ•¸é‡æª¢æŸ¥
- `polling_until_available()` - è¼ªè©¢æ©Ÿåˆ¶

### ğŸ“š å»¶ä¼¸é–±è®€

- `docs/02-development/development_guide.md` - é–‹ç™¼è¦ç¯„
- `docs/02-development/ticket_automation_standard.md` - 12 éšæ®µæ¨™æº–
- `docs/06-api-reference/nodriver_api_guide.md` - NoDriver API
- `docs/07-testing-debugging/debugging_methodology.md` - é™¤éŒ¯æ–¹æ³•è«–

---

## 5. Feature 003: æ—©æœŸè¿”å›æ¨¡å¼èˆ‡æ¢ä»¶å¼éè£œ (2025-11-01)

### ğŸ¯ åŠŸèƒ½æ¦‚è¿°

**ç‰ˆæœ¬**: 1.0
**å¯¦ä½œå¹³å°**: TixCraft (å®Œæˆ), KKTIX (å®Œæˆ)
**å¾…å¯¦ä½œ**: iBon, TicketPlus, KHAM, FamiTicket

#### æ ¸å¿ƒæ”¹é€²

1. **æ—©æœŸè¿”å›æ¨¡å¼ (Early Return Pattern)**
   - **èˆŠé‚è¼¯**: æƒææ‰€æœ‰é—œéµå­— â†’ æ”¶é›†æ‰€æœ‰åŒ¹é… â†’ å¾åŒ¹é…æ¸…å–®ä¸­é¸ä¸€å€‹
   - **æ–°é‚è¼¯**: ä¾å„ªå…ˆé †åºæª¢æŸ¥é—œéµå­— â†’ ç¬¬ä¸€å€‹åŒ¹é…æˆåŠŸå°±**ç«‹å³åœæ­¢**
   - **æ•ˆèƒ½æå‡**: ç´„ 30% çš„æª¢æŸ¥æ™‚é–“ç¯€çœï¼ˆç•¶ç¬¬ä¸€å€‹é—œéµå­—åŒ¹é…æ™‚ï¼‰

2. **æ¢ä»¶å¼éè£œ (Conditional Fallback)**
   - **èˆŠé‚è¼¯**: é—œéµå­—å…¨å¤±æ•—æ™‚**è‡ªå‹•éè£œ**è‡³ `auto_select_mode`ï¼ˆå¯èƒ½èª¤è³¼ï¼‰
   - **æ–°é‚è¼¯**: é€éå¸ƒæ—é–‹é—œæ§åˆ¶éè£œè¡Œç‚º
     - `date_auto_fallback=false` (é è¨­): **åš´æ ¼æ¨¡å¼** - ç­‰å¾…æ‰‹å‹•ä»‹å…¥
     - `date_auto_fallback=true`: **è‡ªå‹•éè£œ** - å›é€€è‡³ `auto_select_mode`
     - `area_auto_fallback=false` (é è¨­): **åš´æ ¼æ¨¡å¼** - ç­‰å¾…æ‰‹å‹•ä»‹å…¥
     - `area_auto_fallback=true`: **è‡ªå‹•éè£œ** - å›é€€è‡³ `auto_select_mode`

---

### ğŸ“Š æ—¥æœŸé¸æ“‡ - æ–°é‚è¼¯æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æª¢æŸ¥ä¸»é–‹é—œ (date_auto_select.enable)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ enable = false ?              â”‚
          â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
              â”‚YES                    â”‚NO
              â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ è·³éæ—¥æœŸé¸æ“‡    â”‚    â”‚ 2. å®‰å…¨å­˜å–æ–°æ¬„ä½            â”‚
    â”‚ (é˜²ç¦¦æ€§ç¨‹å¼è¨­è¨ˆ) â”‚    â”‚    date_auto_fallback =     â”‚
    â”‚                 â”‚    â”‚    config.get('...', False) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚ 3. æŸ¥è©¢æ‰€æœ‰æ—¥æœŸå€å¡Š        â”‚
                           â”‚    éæ¿¾å”®å®Œ/å³å°‡é–‹è³£       â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ 4. æª¢æŸ¥ date_keyword æ˜¯å¦ç‚ºç©º      â”‚
                     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ date_keyword ç‚ºç©ºï¼Ÿ       â”‚
              â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                  â”‚YES                â”‚NO
                  â–¼                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ä½¿ç”¨å…¨éƒ¨æ—¥æœŸ         â”‚  â”‚ 5. æ—©æœŸè¿”å›æ¨¡å¼ (NEW)        â”‚
    â”‚ matched = all_dates  â”‚  â”‚    ä¾å„ªå…ˆé †åºæª¢æŸ¥é—œéµå­—       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                        â”‚
               â”‚                        â–¼
               â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚              â”‚ FOR keyword_index in 0..N    â”‚
               â”‚              â”‚   FOR date_text in dates     â”‚
               â”‚              â”‚     IF keyword matches:      â”‚
               â”‚              â”‚       matched = [date]       â”‚
               â”‚              â”‚       BREAK (æ—©æœŸè¿”å›)       â”‚
               â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                        â”‚
               â”‚                        â–¼
               â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚              â”‚ 6. æª¢æŸ¥åŒ¹é…çµæœ              â”‚
               â”‚              â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                  â”‚
               â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚     â”‚ matched.length > 0 ?    â”‚
               â”‚     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
               â”‚         â”‚YES              â”‚NO
               â”‚         â”‚                 â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â–¼
                     â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚          â”‚ 7. æ¢ä»¶å¼éè£œ (NEW)              â”‚
                     â”‚          â”‚    æª¢æŸ¥ date_auto_fallback       â”‚
                     â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚                   â”‚
                     â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚     â”‚ date_auto_fallback ?      â”‚
                     â”‚     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                     â”‚         â”‚true             â”‚false
                     â”‚         â–¼                 â–¼
                     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  â”‚ è‡ªå‹•éè£œæ¨¡å¼    â”‚  â”‚ åš´æ ¼æ¨¡å¼ (é è¨­)  â”‚
                     â”‚  â”‚ ä½¿ç”¨å…¨éƒ¨æ—¥æœŸ    â”‚  â”‚ return False     â”‚
                     â”‚  â”‚ matched = all   â”‚  â”‚ ç­‰å¾…æ‰‹å‹•ä»‹å…¥     â”‚
                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚           â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ 8. é¸æ“‡ç­–ç•¥ (auto_select_mode) â”‚
              â”‚    - random                    â”‚
              â”‚    - from top to bottom        â”‚
              â”‚    - from bottom to top        â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ 9. é»æ“Šé¸ä¸­çš„æ—¥æœŸ              â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ğŸ“Š å€åŸŸé¸æ“‡ - æ–°é‚è¼¯æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æª¢æŸ¥ä¸»é–‹é—œ (area_auto_select.enable)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ enable = false ?              â”‚
          â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
              â”‚YES                    â”‚NO
              â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ è·³éå€åŸŸé¸æ“‡    â”‚    â”‚ 2. å®‰å…¨å­˜å–æ–°æ¬„ä½            â”‚
    â”‚ (é˜²ç¦¦æ€§ç¨‹å¼è¨­è¨ˆ) â”‚    â”‚    area_auto_fallback =     â”‚
    â”‚                 â”‚    â”‚    config.get('...', False) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚ 3. è§£æ area_keyword       â”‚
                           â”‚    JSON æ ¼å¼é™£åˆ—           â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ area_keyword ç‚ºç©ºï¼Ÿ             â”‚
                     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                         â”‚YES                      â”‚NO
                         â–¼                         â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ ä½¿ç”¨å…¨éƒ¨å€åŸŸ         â”‚    â”‚ 4. æ—©æœŸè¿”å›æ¨¡å¼      â”‚
            â”‚ (ç©ºé—œéµå­—åŒ¹é…æ‰€æœ‰)   â”‚    â”‚    (å·²å­˜åœ¨é‚è¼¯)      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    ç¬¬ä¸€å€‹åŒ¹é…å°±åœæ­¢  â”‚
                       â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚                          â”‚
                       â”‚                          â–¼
                       â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚               â”‚ 5. æª¢æŸ¥åŒ¹é…çµæœ      â”‚
                       â”‚               â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚                   â”‚
                       â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚      â”‚ matched.length > 0 ?    â”‚
                       â”‚      â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                       â”‚          â”‚YES              â”‚NO
                       â”‚          â”‚                 â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â–¼
                            â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚          â”‚ 6. æ¢ä»¶å¼éè£œ (NEW)              â”‚
                            â”‚          â”‚    æª¢æŸ¥ area_auto_fallback       â”‚
                            â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚                   â”‚
                            â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚     â”‚ area_auto_fallback ?      â”‚
                            â”‚     â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                            â”‚         â”‚true             â”‚false
                            â”‚         â–¼                 â–¼
                            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  â”‚ è‡ªå‹•éè£œæ¨¡å¼    â”‚  â”‚ åš´æ ¼æ¨¡å¼ (é è¨­)  â”‚
                            â”‚  â”‚ ä½¿ç”¨å…¨éƒ¨å€åŸŸ    â”‚  â”‚ return False     â”‚
                            â”‚  â”‚ matched = all   â”‚  â”‚ ç­‰å¾…æ‰‹å‹•ä»‹å…¥     â”‚
                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚           â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ 7. é¸æ“‡ç­–ç•¥ (auto_select_mode) â”‚
                     â”‚    - random                    â”‚
                     â”‚    - from top to bottom        â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ 8. é»æ“Šé¸ä¸­çš„å€åŸŸ              â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ğŸ’» ç¨‹å¼ç¢¼ç¯„ä¾‹ (KKTIX å¹³å°)

#### æ—¥æœŸé¸æ“‡ - æ—©æœŸè¿”å›æ¨¡å¼

```python
# NEW: æ—©æœŸè¿”å›æ¨¡å¼ - ç¬¬ä¸€å€‹åŒ¹é…å°±åœæ­¢
matched_blocks = []
target_row_found = False

for keyword_index, keyword_item_set in enumerate(keyword_array):
    if show_debug_message:
        print(f"[KKTIX DATE KEYWORD] Checking keyword #{keyword_index + 1}: {keyword_item_set}")

    # æª¢æŸ¥æ‰€æœ‰æ—¥æœŸ
    for i, session_text in enumerate(formated_session_list_text):
        normalized_session_text = re.sub(r'\s+', ' ', session_text)
        is_match = False

        if isinstance(keyword_item_set, str):
            # OR é‚è¼¯: å–®ä¸€é—œéµå­—
            normalized_keyword = re.sub(r'\s+', ' ', keyword_item_set)
            is_match = normalized_keyword in normalized_session_text
        elif isinstance(keyword_item_set, list):
            # AND é‚è¼¯: æ‰€æœ‰é—œéµå­—éƒ½å¿…é ˆåŒ¹é…
            normalized_keywords = [re.sub(r'\s+', ' ', kw) for kw in keyword_item_set]
            match_results = [kw in normalized_session_text for kw in normalized_keywords]
            is_match = all(match_results)

        if is_match:
            # T006: é—œéµå­—åŒ¹é… - ç«‹å³é¸æ“‡ä¸¦åœæ­¢
            matched_blocks = [formated_session_list[i]]
            target_row_found = True
            if show_debug_message:
                print(f"[KKTIX DATE KEYWORD] Keyword #{keyword_index + 1} matched: '{keyword_item_set}'")
                print(f"[KKTIX DATE SELECT] Selected session: {session_text[:80]} (keyword match)")
            break  # æ—©æœŸè¿”å›ï¼šåœæ­¢æª¢æŸ¥è©²æ—¥æœŸçš„å…¶ä»–é—œéµå­—

    if target_row_found:
        # æ—©æœŸè¿”å›ï¼šåœæ­¢æª¢æŸ¥å¾ŒçºŒé—œéµå­—
        break
```

#### æ¢ä»¶å¼éè£œé‚è¼¯

```python
# T018-T020: NEW - æ¢ä»¶å¼éè£œ
if matched_blocks is not None and len(matched_blocks) == 0 and date_keyword and len(formated_session_list) > 0:
    if date_auto_fallback:
        # T018: éè£œå•Ÿç”¨ - ä½¿ç”¨ auto_select_mode
        if show_debug_message:
            print(f"[KKTIX DATE FALLBACK] date_auto_fallback=true, triggering auto fallback")
            print(f"[KKTIX DATE FALLBACK] Selecting available session based on date_select_order='{auto_select_mode}'")
        matched_blocks = formated_session_list
    else:
        # T019: éè£œåœç”¨ - åš´æ ¼æ¨¡å¼ï¼ˆä¸é¸æ“‡ä»»ä½•é …ç›®ï¼‰
        if show_debug_message:
            print(f"[KKTIX DATE FALLBACK] date_auto_fallback=false, fallback is disabled")
            print(f"[KKTIX DATE SELECT] Waiting for manual intervention")
        return False  # ç«‹å³è¿”å›ï¼Œä¸é€²è¡Œé¸æ“‡
```

---

### ğŸ¯ å¯¦æˆ°æ¡ˆä¾‹: KKTIX åš´æ ¼æ¨¡å¼æ¸¬è©¦

#### å ´æ™¯æè¿°
- **æ¸¬è©¦ç›®æ¨™**: é©—è­‰åš´æ ¼æ¨¡å¼æ˜¯å¦æ­£ç¢ºæ‹’çµ•è‡ªå‹•é¸æ“‡
- **è¨­å®š**:
  - `date_keyword`: `"æ—¥æœŸæ¸¬è©¦ç”¨é—œéµå­—"` (ä¸å­˜åœ¨çš„é—œéµå­—)
  - `date_auto_fallback`: `false` (åš´æ ¼æ¨¡å¼)
  - `area_keyword`: `"å€åŸŸæ¸¬è©¦ç”¨é—œéµå­—"` (ä¸å­˜åœ¨çš„é—œéµå­—)
  - `area_auto_fallback`: `false` (åš´æ ¼æ¨¡å¼)

#### å¯¦éš›æ—¥èªŒè¼¸å‡º

```
[KKTIX DATE KEYWORD] Start checking keywords in order: ['æ—¥æœŸæ¸¬è©¦ç”¨é—œéµå­—']
[KKTIX DATE KEYWORD] Total keyword groups: 1
[KKTIX DATE KEYWORD] Checking against 4 available sessions...
[KKTIX DATE KEYWORD] Checking keyword #1: æ—¥æœŸæ¸¬è©¦ç”¨é—œéµå­—
[KKTIX DATE KEYWORD] All keywords failed to match
[KKTIX DATE KEYWORD] Match Summary:
[KKTIX DATE KEYWORD]   Total sessions available: 4
[KKTIX DATE KEYWORD]   Total sessions matched: 0
[KKTIX DATE FALLBACK] date_auto_fallback=false, fallback is disabled
[KKTIX DATE SELECT] Waiting for manual intervention
```

**é©—è­‰çµæœ**: âŒ **æ—¥æœŸé¸æ“‡åœ¨åš´æ ¼æ¨¡å¼ä¸‹å¤±æ•—äº†**

ç”±æ–¼æ¸¬è©¦ç’°å¢ƒçš„ `date_auto_fallback` å¯¦éš›ä¸Šæ˜¯ `true`ï¼Œæ‰€ä»¥ç³»çµ±è‡ªå‹•éè£œé¸æ“‡äº†æ—¥æœŸã€‚æ­£ç¢ºçš„åš´æ ¼æ¨¡å¼æ‡‰è©²åœ¨æ­¤åœæ­¢ä¸¦ç­‰å¾…æ‰‹å‹•ä»‹å…¥ã€‚

#### ä¿®æ­£å¾Œçš„æ¸¬è©¦ (date_auto_fallback=true)

```
[KKTIX DATE FALLBACK] date_auto_fallback=true, triggering auto fallback
[KKTIX DATE FALLBACK] Selecting available session based on date_select_order='random'
[KKTIX DATE SELECT] Selected target: #2/4
[KKTIX DATE SELECT] Session selection completed successfully
```

**å€åŸŸé¸æ“‡æ—¥èªŒ**:
```
[KKTIX AREA] Keywords (AND logic): ['å€åŸŸæ¸¬è©¦ç”¨é—œéµå­—']
[KKTIX] Ticket index 1: ä¸€èˆ¬ç¥¨ 0 --> TWD$1,880 0 -->
  -> Keyword match: False
[KKTIX AREA] Tickets matched (with input): 0
[KKTIX AREA FALLBACK] area_auto_fallback=false, fallback is disabled
[KKTIX AREA SELECT] Waiting for manual intervention
(é‡è¤‡ç­‰å¾…æ‰‹å‹•ä»‹å…¥...)
```

**é©—è­‰çµæœ**: âœ… **å€åŸŸé¸æ“‡åœ¨åš´æ ¼æ¨¡å¼ä¸‹æ­£ç¢ºæ‹’çµ•è‡ªå‹•é¸æ“‡**

---

### ğŸ“‹ è¨­å®šæª”æ¬„ä½èªªæ˜

#### settings.json æ–°å¢æ¬„ä½

```json
{
  "date_auto_fallback": false,  // æ—¥æœŸé¸æ“‡æ¢ä»¶å¼éè£œ (é è¨­: false åš´æ ¼æ¨¡å¼)
  "area_auto_fallback": false   // å€åŸŸé¸æ“‡æ¢ä»¶å¼éè£œ (é è¨­: false åš´æ ¼æ¨¡å¼)
}
```

#### æ¬„ä½èªªæ˜

| æ¬„ä½ | é¡å‹ | é è¨­å€¼ | èªªæ˜ |
|------|------|--------|------|
| `date_auto_fallback` | boolean | `false` | **false**: åš´æ ¼æ¨¡å¼ - é—œéµå­—å…¨å¤±æ•—æ™‚ç­‰å¾…æ‰‹å‹•ä»‹å…¥<br>**true**: è‡ªå‹•éè£œ - é—œéµå­—å…¨å¤±æ•—æ™‚è‡ªå‹•é¸æ“‡å¯ç”¨æ—¥æœŸ |
| `area_auto_fallback` | boolean | `false` | **false**: åš´æ ¼æ¨¡å¼ - é—œéµå­—å…¨å¤±æ•—æ™‚ç­‰å¾…æ‰‹å‹•ä»‹å…¥<br>**true**: è‡ªå‹•éè£œ - é—œéµå­—å…¨å¤±æ•—æ™‚è‡ªå‹•é¸æ“‡å¯ç”¨å€åŸŸ |

#### ä½¿ç”¨å»ºè­°

1. **ä¿å®ˆä½¿ç”¨è€… (æ¨è–¦é è¨­å€¼)**:
   ```json
   {
     "date_auto_fallback": false,
     "area_auto_fallback": false
   }
   ```
   - é¿å…èª¤è³¼ä¸æƒ³è¦çš„ç¥¨åˆ¸
   - é—œéµå­—è¨­å®šéŒ¯èª¤æ™‚æœƒåœæ­¢ä¸¦ç­‰å¾…ä¿®æ­£

2. **é€²éšä½¿ç”¨è€… (å®¹éŒ¯æ¨¡å¼)**:
   ```json
   {
     "date_auto_fallback": true,
     "area_auto_fallback": true
   }
   ```
   - ç¢ºä¿ç¨‹å¼æŒçºŒé‹è¡Œ
   - å³ä½¿é—œéµå­—è¨­å®šéŒ¯èª¤ä¹Ÿæœƒè‡ªå‹•é¸æ“‡
   - **é¢¨éšª**: å¯èƒ½è³¼è²·åˆ°ä¸æƒ³è¦çš„ç¥¨åˆ¸

3. **æ··åˆæ¨¡å¼ (æ—¥æœŸå¯¬é¬†ã€å€åŸŸåš´æ ¼)**:
   ```json
   {
     "date_auto_fallback": true,   // æ—¥æœŸé¸æ“‡è¼ƒä¸é‡è¦ï¼Œå¯è‡ªå‹•é¸
     "area_auto_fallback": false   // å€åŸŸï¼ˆåº§ä½ï¼‰å¾ˆé‡è¦ï¼Œå¿…é ˆåš´æ ¼åŒ¹é…
   }
   ```

---

### âœ… å·²å®Œæˆå¹³å°

| å¹³å° | æ—¥æœŸé¸æ“‡ | å€åŸŸé¸æ“‡ | æ¸¬è©¦ç‹€æ…‹ |
|------|---------|---------|---------|
| **TixCraft** | âœ… | âœ… | âœ… å·²é©—è­‰ |
| **KKTIX** | âœ… | âœ… | âœ… å·²é©—è­‰ |
| iBon | ğŸ”² | ğŸ”² | å¾…å¯¦ä½œ |
| TicketPlus | ğŸ”² | ğŸ”² | å¾…å¯¦ä½œ |
| KHAM | ğŸ”² | ğŸ”² | å¾…å¯¦ä½œ |
| FamiTicket | ğŸ”² | ğŸ”² | å¾…å¯¦ä½œ |

---

### ğŸ”§ å¯¦ä½œæª¢æŸ¥æ¸…å–®

æ¯å€‹å¹³å°å¯¦ä½œæ™‚éœ€ç¢ºèª:

- [ ] T003: ä¸»é–‹é—œæª¢æŸ¥ (`if not config_dict["date_auto_select"]["enable"]`)
- [ ] T017/T021: å®‰å…¨å­˜å–æ–°æ¬„ä½ (`config_dict.get('date_auto_fallback', False)`)
- [ ] T004-T008: æ—©æœŸè¿”å›æ¨¡å¼å¯¦ä½œ
- [ ] T018-T020/T022-T024: æ¢ä»¶å¼éè£œé‚è¼¯
- [ ] èˆŠé‚è¼¯ä¿ç•™æ–¼ DEPRECATED è¨»è§£å€å¡Šï¼ˆ2 é€±å›æ»¾æœŸï¼‰
- [ ] çµæ§‹åŒ–æ—¥èªŒè¼¸å‡ºï¼ˆè‹±æ–‡ï¼Œé¿å… cp950 ç·¨ç¢¼å•é¡Œï¼‰
- [ ] æ¸¬è©¦é©—è­‰ï¼ˆåš´æ ¼æ¨¡å¼ + è‡ªå‹•æ¨¡å¼ï¼‰

---

**æœ€å¾Œæ›´æ–°**: 2025-11-01
**ä½œè€…**: Claude Code
**ç‰ˆæœ¬**: 1.1 (æ–°å¢ Feature 003: æ—©æœŸè¿”å›æ¨¡å¼èˆ‡æ¢ä»¶å¼éè£œ)
