# éŸ³æ•ˆé€šçŸ¥ç³»çµ± (Sound Notification System)

**æ–‡ä»¶èªªæ˜**ï¼šèªªæ˜ Tickets Hunter çš„éŸ³æ•ˆé€šçŸ¥æ©Ÿåˆ¶ã€å…©éšæ®µéŸ³æ•ˆè¨­è¨ˆã€å¯¦ä½œé‚è¼¯èˆ‡ç¨‹å¼ç¢¼ç¯„ä¾‹
**æœ€å¾Œæ›´æ–°**ï¼š2025-11-12

---

æœ¬æ–‡ä»¶èªªæ˜æ¶ç¥¨ç³»çµ±ä¸­çš„éŸ³æ•ˆé€šçŸ¥æ©Ÿåˆ¶ï¼ŒåŒ…å«å…©éšæ®µéŸ³æ•ˆè¨­è¨ˆã€å¯¦ä½œé‚è¼¯èˆ‡ç¨‹å¼ç¢¼ç¯„ä¾‹ã€‚

---

## ğŸ“‹ ç›®éŒ„

- [æ¦‚è¿°](#æ¦‚è¿°)
- [è¨­å®šåƒæ•¸èªªæ˜](#è¨­å®šåƒæ•¸èªªæ˜)
- [å…©éšæ®µéŸ³æ•ˆé‚è¼¯](#å…©éšæ®µéŸ³æ•ˆé‚è¼¯)
- [å¯¦ä½œç´°ç¯€](#å¯¦ä½œç´°ç¯€)
- [ç¨‹å¼ç¢¼ç¯„ä¾‹](#ç¨‹å¼ç¢¼ç¯„ä¾‹)
- [å¹³å°å¯¦ä½œç´¢å¼•](#å¹³å°å¯¦ä½œç´¢å¼•)
- [æ³¨æ„äº‹é …èˆ‡æœ€ä½³å¯¦è¸](#æ³¨æ„äº‹é …èˆ‡æœ€ä½³å¯¦è¸)

---

## æ¦‚è¿°

### è¨­è¨ˆç†å¿µ

éŸ³æ•ˆé€šçŸ¥ç³»çµ±æ¡ç”¨**å…©éšæ®µé€šçŸ¥è¨­è¨ˆ**ï¼Œåˆ†åˆ¥åœ¨è³¼ç¥¨æµç¨‹çš„å…©å€‹é—œéµæ™‚åˆ»æä¾›éŸ³æ•ˆåé¥‹ï¼š

1. **éšæ®µ 1ï¼šæ‰¾åˆ°ç¥¨ï¼ˆæœ‰ç¥¨é€šçŸ¥ï¼‰** - ç•¶ç³»çµ±æ‰¾åˆ°å¯è³¼è²·çš„ç¥¨ä¸¦å˜—è©¦é€²å…¥çµå¸³æ™‚
2. **éšæ®µ 2ï¼šè³¼ç¥¨æˆåŠŸï¼ˆè¨‚å–®é€šçŸ¥ï¼‰** - ç•¶ç³»çµ±çœŸæ­£åˆ°é”çµå¸³é é¢ä¸¦å®Œæˆè¨‚å–®æ™‚

### ç‚ºä»€éº¼éœ€è¦å…©éšæ®µï¼Ÿ

åœ¨è¨±å¤šå”®ç¥¨å¹³å°ï¼ˆå¦‚ ibonã€KKTIXï¼‰ï¼Œå¾ã€Œæ‰¾åˆ°ç¥¨ã€åˆ°ã€Œè³¼ç¥¨æˆåŠŸã€ä¹‹é–“å¯èƒ½å­˜åœ¨ï¼š
- **æ’éšŠæ©Ÿåˆ¶**ï¼šéœ€è¦ç­‰å¾…å…¶ä»–ç”¨æˆ¶å®Œæˆäº¤æ˜“
- **åº§ä½åˆ†é…å»¶é²**ï¼šç³»çµ±éœ€è¦æ™‚é–“åˆ†é…åº§ä½
- **ç¶²è·¯å»¶é²**ï¼šç¶²é å°èˆªéœ€è¦æ™‚é–“
- **å¯èƒ½å¤±æ•—**ï¼šæ’éšŠè¶…æ™‚ã€åº§ä½è¢«æ¶èµ°ã€ç³»çµ±éŒ¯èª¤ç­‰

å› æ­¤ï¼Œå…©éšæ®µéŸ³æ•ˆå¯ä»¥ï¼š
- âœ… **ç¬¬ä¸€æ™‚é–“é€šçŸ¥ç”¨æˆ¶**ï¼šæœ‰ç¥¨æ™‚ç«‹å³æ’­æ”¾éŸ³æ•ˆï¼Œç”¨æˆ¶å¯ä»¥æº–å‚™
- âœ… **ç¢ºèªæœ€çµ‚çµæœ**ï¼šçœŸæ­£è³¼ç¥¨æˆåŠŸæ™‚å†æ¬¡æ’­æ”¾ï¼Œé¿å…èª¤åˆ¤
- âœ… **å€åˆ†ç‹€æ…‹**ï¼šå¦‚æœåªè½åˆ°ç¬¬ä¸€æ¬¡éŸ³æ•ˆä½†æ²’æœ‰ç¬¬äºŒæ¬¡ï¼Œè¡¨ç¤ºæ’éšŠå¤±æ•—

---

## è¨­å®šåƒæ•¸èªªæ˜

### settings.json è¨­å®šçµæ§‹

```json
{
  "advanced": {
    "play_sound": {
      "ticket": true,
      "order": true,
      "filename": "assets/sounds/ding-dong.wav"
    }
  }
}
```

### åƒæ•¸è©³è§£

| åƒæ•¸ | é¡å‹ | èªªæ˜ | é è¨­å€¼ |
|------|------|------|--------|
| `ticket` | boolean | **æœ‰ç¥¨æ™‚æ’­æ”¾éŸ³æ•ˆ**<br>ç•¶æ‰¾åˆ°å¯è³¼è²·çš„ç¥¨ä¸¦é»æ“Šè³¼è²·æŒ‰éˆ•æ™‚æ’­æ”¾ | `true` |
| `order` | boolean | **è¨‚è³¼å®Œæˆæ™‚æ’­æ”¾éŸ³æ•ˆ**<br>ç•¶æˆåŠŸåˆ°é”çµå¸³é é¢ï¼ˆcheckoutï¼‰æ™‚æ’­æ”¾ | `true` |
| `filename` | string | éŸ³æ•ˆæª”æ¡ˆè·¯å¾‘ï¼ˆç›¸å°æ–¼å°ˆæ¡ˆæ ¹ç›®éŒ„ï¼‰ | `"assets/sounds/ding-dong.wav"` |

### å¸¸è¦‹è¨­å®šçµ„åˆ

#### 1. å…©éšæ®µéƒ½é€šçŸ¥ï¼ˆæ¨è–¦ï¼‰
```json
"play_sound": {
  "ticket": true,
  "order": true
}
```
**é©ç”¨å ´æ™¯**ï¼šå¸Œæœ›åœ¨æ‰¾åˆ°ç¥¨å’Œè³¼ç¥¨æˆåŠŸæ™‚éƒ½æ”¶åˆ°é€šçŸ¥

#### 2. åªåœ¨è³¼ç¥¨æˆåŠŸæ™‚é€šçŸ¥
```json
"play_sound": {
  "ticket": false,
  "order": true
}
```
**é©ç”¨å ´æ™¯**ï¼šé¿å…è™›é©šä¸€å ´ï¼Œåªæƒ³åœ¨çœŸæ­£è³¼ç¥¨æˆåŠŸæ™‚æ”¶åˆ°é€šçŸ¥

#### 3. é—œé–‰æ‰€æœ‰éŸ³æ•ˆ
```json
"play_sound": {
  "ticket": false,
  "order": false
}
```
**é©ç”¨å ´æ™¯**ï¼šç„¡è²æ¨¡å¼ã€æ¸¬è©¦ç’°å¢ƒ

---

## å…©éšæ®µéŸ³æ•ˆé‚è¼¯

### éšæ®µ 1ï¼šæœ‰ç¥¨é€šçŸ¥ (`play_sound.ticket`)

#### è§¸ç™¼æ™‚æ©Ÿ

ç•¶ä»¥ä¸‹æ¢ä»¶**å…¨éƒ¨æ»¿è¶³**æ™‚æ’­æ”¾ï¼š

1. âœ… å·²é¸æ“‡æ—¥æœŸã€å€åŸŸã€ç¥¨æ•¸
2. âœ… å·²å®Œæˆé©—è­‰ç¢¼å¡«å¯«
3. âœ… **é»æ“Šè³¼è²·æŒ‰éˆ•æˆåŠŸ**ï¼ˆ`click_ret = True`ï¼‰
4. âœ… `config_dict["advanced"]["play_sound"]["ticket"]` ç‚º `true`
5. âœ… æœ¬æ¬¡è³¼ç¥¨æµç¨‹ä¸­å°šæœªæ’­æ”¾éï¼ˆ`ibon_dict["played_sound_ticket"] = False`ï¼‰

#### æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰¾åˆ°å¯è³¼è²·çš„ç¥¨         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¡«å¯«é©—è­‰ç¢¼             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é»æ“Šè³¼è²·æŒ‰éˆ• (æˆåŠŸ)    â”‚ â—„â”€â”€â”€ éšæ®µ 1 è§¸ç™¼é»
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    ğŸ”Š æ’­æ”¾ ticket éŸ³æ•ˆ
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é€²å…¥æ’éšŠ/ç­‰å¾…ç‹€æ…‹      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ç¨‹å¼ç¢¼ä½ç½®

- **ibon èˆŠç‰ˆï¼ˆUTK0201ï¼‰**ï¼š`nodriver_tixcraft.py` ç¬¬ 11949 è¡Œã€12249 è¡Œ
- **ibon æ–°ç‰ˆï¼ˆEventBuyï¼‰**ï¼š`nodriver_tixcraft.py` ç¬¬ 12102 è¡Œ
- **TixCraft**ï¼š`nodriver_tixcraft.py` ç¬¬ 3404 è¡Œ
- **KKTIX**ï¼š`nodriver_tixcraft.py` ç¬¬ 1715 è¡Œ

---

### éšæ®µ 2ï¼šè¨‚å–®é€šçŸ¥ (`play_sound.order`)

#### è§¸ç™¼æ™‚æ©Ÿ

ç•¶ä»¥ä¸‹æ¢ä»¶**å…¨éƒ¨æ»¿è¶³**æ™‚æ’­æ”¾ï¼š

1. âœ… URL åŒ…å«çµå¸³é é¢è·¯å¾‘ï¼ˆå¦‚ `/utk02/utk0206_.aspx`ã€`/order/status`ï¼‰
2. âœ… `config_dict["advanced"]["play_sound"]["order"]` ç‚º `true`
3. âœ… æœ¬æ¬¡è³¼ç¥¨æµç¨‹ä¸­å°šæœªæ’­æ”¾éï¼ˆ`ibon_dict["played_sound_order"] = False`ï¼‰

#### æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ’éšŠä¸­...              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æˆåŠŸåˆ†é…åº§ä½           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å°èˆªåˆ°çµå¸³é é¢         â”‚ â—„â”€â”€â”€ éšæ®µ 2 è§¸ç™¼é»
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    ğŸ”Š æ’­æ”¾ order éŸ³æ•ˆ
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è³¼ç¥¨å®Œæˆï¼             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ç¨‹å¼ç¢¼ä½ç½®

- **ibon**ï¼š`nodriver_tixcraft.py` ç¬¬ 12309 è¡Œ
- **TixCraft**ï¼š`nodriver_tixcraft.py` ç¬¬ 3436 è¡Œ
- **KKTIX**ï¼š`nodriver_tixcraft.py` ç¬¬ 1946 è¡Œ
- **TicketPlus**ï¼š`nodriver_tixcraft.py` ç¬¬ 6063 è¡Œ
- **KHAM**ï¼š`nodriver_tixcraft.py` ç¬¬ 14924 è¡Œ
- **Ticket.com.tw**ï¼š`nodriver_tixcraft.py` ç¬¬ 17063 è¡Œ

---

### å®Œæ•´æµç¨‹ç¯„ä¾‹

#### æˆåŠŸè³¼ç¥¨æµç¨‹

```
1. æ‰¾åˆ°ç¥¨ â†’ é»æ“Šè³¼è²·æŒ‰éˆ•
   â””â”€â–º ğŸ”Š æ’­æ”¾ ticket éŸ³æ•ˆ (éšæ®µ 1)

2. æ’éšŠä¸­...ï¼ˆç­‰å¾… 5 ç§’ï¼‰

3. æˆåŠŸé€²å…¥çµå¸³é é¢
   â””â”€â–º ğŸ”Š æ’­æ”¾ order éŸ³æ•ˆ (éšæ®µ 2)

ç¸½å…±æ’­æ”¾ 2 æ¬¡éŸ³æ•ˆ
```

#### æ’éšŠå¤±æ•—æµç¨‹

```
1. æ‰¾åˆ°ç¥¨ â†’ é»æ“Šè³¼è²·æŒ‰éˆ•
   â””â”€â–º ğŸ”Š æ’­æ”¾ ticket éŸ³æ•ˆ (éšæ®µ 1)

2. æ’éšŠä¸­...ï¼ˆç­‰å¾… 30 ç§’ï¼‰

3. âŒ æ’éšŠè¶…æ™‚ï¼Œè¿”å›ç¥¨åˆ¸é é¢
   â””â”€â–º ğŸ”‡ ä¸æ’­æ”¾ order éŸ³æ•ˆ

ç¸½å…±æ’­æ”¾ 1 æ¬¡éŸ³æ•ˆï¼ˆå‘ŠçŸ¥æœ‰ç¥¨ï¼Œä½†æœªè³¼ç¥¨æˆåŠŸï¼‰
```

---

## å¯¦ä½œç´°ç¯€

### é˜²é‡è¤‡æ’­æ”¾æ©Ÿåˆ¶

ä½¿ç”¨å…¨åŸŸå­—å…¸ `{platform}_dict` å„²å­˜æ’­æ”¾ç‹€æ…‹ï¼š

```python
# ä»¥ ibon ç‚ºä¾‹
ibon_dict = {
    "played_sound_ticket": False,  # éšæ®µ 1 éŸ³æ•ˆæ˜¯å¦å·²æ’­æ”¾
    "played_sound_order": False,   # éšæ®µ 2 éŸ³æ•ˆæ˜¯å¦å·²æ’­æ”¾
}
```

### ç‹€æ…‹é‡ç½®æ™‚æ©Ÿ

ç•¶ç”¨æˆ¶**é›¢é–‹çµå¸³é é¢**æ™‚ï¼Œé‡ç½®æ‰€æœ‰éŸ³æ•ˆç‹€æ…‹ï¼ˆå…è¨±ä¸‹æ¬¡è³¼ç¥¨é‡æ–°æ’­æ”¾ï¼‰ï¼š

```python
if '/utk02/utk0206_.aspx' in url.lower():
    # åœ¨çµå¸³é é¢ï¼šæ’­æ”¾éŸ³æ•ˆã€è§¸ç™¼ idle
    # ...
else:
    # é›¢é–‹çµå¸³é é¢ï¼šé‡ç½®ç‹€æ…‹
    ibon_dict["is_popup_checkout"] = False
    ibon_dict["played_sound_order"] = False
    ibon_dict["played_sound_ticket"] = False  # â† é‡ç½®ï¼
    ibon_dict["shown_checkout_message"] = False
```

### éŸ³æ•ˆæ’­æ”¾å‡½æ•¸

```python
def play_sound_while_ordering(config_dict):
    """æ’­æ”¾éŸ³æ•ˆï¼ˆéåŒæ­¥ï¼‰"""
    app_root = util.get_app_root()
    captcha_sound_filename = os.path.join(
        app_root,
        config_dict["advanced"]["play_sound"]["filename"].strip()
    )
    util.play_mp3_async(captcha_sound_filename)
```

**ç‰¹æ€§**ï¼š
- ä½¿ç”¨ `play_mp3_async`ï¼Œä¸æœƒé˜»å¡ä¸»åŸ·è¡Œç·’
- æ”¯æ´ `.wav`ã€`.mp3` æ ¼å¼
- æª”æ¡ˆè·¯å¾‘ç›¸å°æ–¼å°ˆæ¡ˆæ ¹ç›®éŒ„

---

## ç¨‹å¼ç¢¼ç¯„ä¾‹

### ç¯„ä¾‹ 1ï¼šibon æ–°ç‰ˆ EventBuy é é¢ï¼ˆéšæ®µ 1ï¼‰

```python
# ä½ç½®ï¼šnodriver_tixcraft.py ç¬¬ 12097-12107 è¡Œ

click_ret = await nodriver_ibon_purchase_button_press(tab, config_dict)

# Play sound if button clicked successfully
if click_ret:
    # Play "ticket" sound when attempting to enter checkout (found ticket)
    if config_dict["advanced"]["play_sound"]["ticket"]:
        if not ibon_dict.get("played_sound_ticket", False):
            play_sound_while_ordering(config_dict)
            ibon_dict["played_sound_ticket"] = True
    if show_debug_message:
        print("[NEW EVENTBUY] Purchase button clicked successfully")
```

**é—œéµé»**ï¼š
1. âœ… æª¢æŸ¥ `click_ret`ï¼ˆè³¼è²·æŒ‰éˆ•æ˜¯å¦é»æ“ŠæˆåŠŸï¼‰
2. âœ… æª¢æŸ¥ `play_sound.ticket` è¨­å®š
3. âœ… æª¢æŸ¥ `played_sound_ticket` é˜²é‡è¤‡
4. âœ… æ’­æ”¾å¾Œç«‹å³è¨­å®š `played_sound_ticket = True`

---

### ç¯„ä¾‹ 2ï¼šibon çµå¸³é é¢ï¼ˆéšæ®µ 2ï¼‰

```python
# ä½ç½®ï¼šnodriver_tixcraft.py ç¬¬ 12301-12333 è¡Œ

# Check if reached checkout page (ticket purchase successful)
# https://orders.ibon.com.tw/application/UTK02/UTK0206_.aspx
if '/utk02/utk0206_.aspx' in url.lower():
    # Show debug message (only once)
    if config_dict["advanced"].get("verbose", False):
        if not ibon_dict["shown_checkout_message"]:
            print("Reached checkout page - ticket purchase successful!")
        ibon_dict["shown_checkout_message"] = True

    # Play sound notification (only once)
    if config_dict["advanced"]["play_sound"]["order"]:
        if not ibon_dict["played_sound_order"]:
            play_sound_while_ordering(config_dict)
        ibon_dict["played_sound_order"] = True

    # If headless mode, open browser to show checkout page (only once)
    if config_dict["advanced"]["headless"]:
        if not ibon_dict["is_popup_checkout"]:
            checkout_url = url
            print("æ¶ç¥¨æˆåŠŸ, è«‹å‰å¾€è©²å¸³è™Ÿè¨‚å–®æŸ¥çœ‹: %s" % (checkout_url))
            webbrowser.open_new(checkout_url)
            ibon_dict["is_popup_checkout"] = True

    # Trigger idle mode (only once)
    if not ibon_dict.get("triggered_idle", False):
        settings.maxbot_idle()
        if config_dict["advanced"].get("verbose", False):
            print("[INFO] Triggered maxbot_idle() - entering idle mode")
        ibon_dict["triggered_idle"] = True
else:
    # Reset status when leaving checkout page
    ibon_dict["is_popup_checkout"] = False
    ibon_dict["played_sound_order"] = False
    ibon_dict["played_sound_ticket"] = False  # â† é‡ç½®éšæ®µ 1 ç‹€æ…‹
    ibon_dict["shown_checkout_message"] = False
```

**é—œéµé»**ï¼š
1. âœ… URL åˆ¤æ–·ï¼ˆç¢ºèªåˆ°é”çµå¸³é é¢ï¼‰
2. âœ… æª¢æŸ¥ `play_sound.order` è¨­å®š
3. âœ… æª¢æŸ¥ `played_sound_order` é˜²é‡è¤‡
4. âœ… `else` å€å¡Šé‡ç½®æ‰€æœ‰ç‹€æ…‹ï¼ˆåŒ…æ‹¬ `played_sound_ticket`ï¼‰

---

### ç¯„ä¾‹ 3ï¼šTixCraft ç¥¨åˆ¸é é¢ï¼ˆéšæ®µ 1ï¼‰

```python
# ä½ç½®ï¼šnodriver_tixcraft.py ç¬¬ 3401-3407 è¡Œ

# Play sound when ticket is available
if config_dict["advanced"]["play_sound"]["ticket"]:
    if not tixcraft_dict["played_sound_ticket"]:
        play_sound_while_ordering(config_dict)
    tixcraft_dict["played_sound_ticket"] = True
else:
    tixcraft_dict["played_sound_ticket"] = False
```

**æ³¨æ„**ï¼š
- TixCraft åœ¨ã€Œæ‰¾åˆ°ç¥¨åˆ¸é é¢ã€æ™‚æ’­æ”¾ `ticket` éŸ³æ•ˆ
- èˆ‡ ibon ä¸åŒï¼ŒTixCraft ä¸éœ€è¦ç­‰åˆ°é»æ“ŠæŒ‰éˆ•

---

## å¹³å°å¯¦ä½œç´¢å¼•

### ibon

| éšæ®µ | è§¸ç™¼é» | ç¨‹å¼ç¢¼ä½ç½® | è¨­å®šåƒæ•¸ |
|------|--------|-----------|---------|
| éšæ®µ 1 | èˆŠç‰ˆ UTK0201 è³¼è²·æŒ‰éˆ•é»æ“Š | 11949 è¡Œ | `play_sound.ticket` |
| éšæ®µ 1 | æ–°ç‰ˆ EventBuy è³¼è²·æŒ‰éˆ•é»æ“Š | 12102 è¡Œ | `play_sound.ticket` |
| éšæ®µ 1 | èˆŠç‰ˆ UTK0201 è³¼è²·æŒ‰éˆ•é»æ“Šï¼ˆå¦ä¸€æµç¨‹ï¼‰ | 12249 è¡Œ | `play_sound.ticket` |
| éšæ®µ 2 | åˆ°é”çµå¸³é é¢ (UTK0206) | 12309 è¡Œ | `play_sound.order` |

### TixCraft

| éšæ®µ | è§¸ç™¼é» | ç¨‹å¼ç¢¼ä½ç½® | è¨­å®šåƒæ•¸ |
|------|--------|-----------|---------|
| éšæ®µ 1 | ç¥¨åˆ¸é é¢ï¼ˆæœ‰ç¥¨ï¼‰ | 3404 è¡Œ | `play_sound.ticket` |
| éšæ®µ 2 | åˆ°é”ç¢ºèªé é¢ | 3436 è¡Œ | `play_sound.order` |

### KKTIX

| éšæ®µ | è§¸ç™¼é» | ç¨‹å¼ç¢¼ä½ç½® | è¨­å®šåƒæ•¸ |
|------|--------|-----------|---------|
| éšæ®µ 1 | ç¥¨åˆ¸é é¢ï¼ˆæœ‰ç¥¨ï¼‰ | 1715 è¡Œ | `play_sound.ticket` |
| éšæ®µ 2 | åˆ°é”ç¢ºèªé é¢ | 1946 è¡Œ | `play_sound.order` |

### TicketPlus

| éšæ®µ | è§¸ç™¼é» | ç¨‹å¼ç¢¼ä½ç½® | è¨­å®šåƒæ•¸ |
|------|--------|-----------|---------|
| éšæ®µ 2 | åˆ°é”ç¢ºèªé é¢ | 6063 è¡Œ | `play_sound.order` |

**æ³¨æ„**ï¼šTicketPlus ç›®å‰åƒ…å¯¦ä½œéšæ®µ 2 éŸ³æ•ˆ

### KHAM

| éšæ®µ | è§¸ç™¼é» | ç¨‹å¼ç¢¼ä½ç½® | è¨­å®šåƒæ•¸ |
|------|--------|-----------|---------|
| éšæ®µ 2 | åˆ°é”çµå¸³é é¢ | 14924 è¡Œ | `play_sound.order` |

### Ticket.com.tw

| éšæ®µ | è§¸ç™¼é» | ç¨‹å¼ç¢¼ä½ç½® | è¨­å®šåƒæ•¸ |
|------|--------|-----------|---------|
| éšæ®µ 2 | è¨‚å–®é€å‡ºæˆåŠŸ | 17063 è¡Œ | `play_sound.order` |

### Cityline

| éšæ®µ | è§¸ç™¼é» | ç¨‹å¼ç¢¼ä½ç½® | è¨­å®šåƒæ•¸ |
|------|--------|-----------|---------|
| éšæ®µ 1 | ç¥¨åˆ¸é é¢ï¼ˆæœ‰ç¥¨ï¼‰ | 13007 è¡Œ | `play_sound.ticket` |

**æ³¨æ„**ï¼šCityline ç›®å‰åƒ…å¯¦ä½œéšæ®µ 1 éŸ³æ•ˆ

---

## æ³¨æ„äº‹é …èˆ‡æœ€ä½³å¯¦è¸

### âš ï¸ å¸¸è¦‹éŒ¯èª¤

#### âŒ éŒ¯èª¤ 1ï¼šæ²’æœ‰æª¢æŸ¥è¨­å®š

```python
# âŒ éŒ¯èª¤ï¼šç„¡æ¢ä»¶æ’­æ”¾éŸ³æ•ˆ
if click_ret:
    play_sound_while_ordering(config_dict)
```

```python
# âœ… æ­£ç¢ºï¼šæª¢æŸ¥è¨­å®š
if click_ret:
    if config_dict["advanced"]["play_sound"]["ticket"]:
        if not ibon_dict.get("played_sound_ticket", False):
            play_sound_while_ordering(config_dict)
            ibon_dict["played_sound_ticket"] = True
```

---

#### âŒ éŒ¯èª¤ 2ï¼šå…±ç”¨é˜²é‡è¤‡æ¨™è¨˜

```python
# âŒ éŒ¯èª¤ï¼šéšæ®µ 1 å’Œéšæ®µ 2 å…±ç”¨åŒä¸€å€‹æ¨™è¨˜
if click_ret:
    if config_dict["advanced"]["play_sound"]["ticket"]:
        if not ibon_dict.get("played_sound_order", False):  # â† éŒ¯èª¤ï¼
            play_sound_while_ordering(config_dict)
            ibon_dict["played_sound_order"] = True
```

**å•é¡Œ**ï¼šå¦‚æœéšæ®µ 1 æ’­æ”¾å¾Œè¨­å®š `played_sound_order = True`ï¼Œéšæ®µ 2 å°±ä¸æœƒæ’­æ”¾äº†ï¼

```python
# âœ… æ­£ç¢ºï¼šå„è‡ªä½¿ç”¨ç¨ç«‹æ¨™è¨˜
# éšæ®µ 1 ä½¿ç”¨ played_sound_ticket
# éšæ®µ 2 ä½¿ç”¨ played_sound_order
```

---

#### âŒ éŒ¯èª¤ 3ï¼šå¿˜è¨˜é‡ç½®ç‹€æ…‹

```python
# âŒ éŒ¯èª¤ï¼šåªé‡ç½® played_sound_order
else:
    ibon_dict["played_sound_order"] = False
    # ç¼ºå°‘ played_sound_ticket é‡ç½®ï¼
```

```python
# âœ… æ­£ç¢ºï¼šé‡ç½®æ‰€æœ‰ç‹€æ…‹
else:
    ibon_dict["played_sound_order"] = False
    ibon_dict["played_sound_ticket"] = False  # â† å¿…é ˆï¼
    ibon_dict["shown_checkout_message"] = False
```

---

### âœ… æœ€ä½³å¯¦è¸

#### 1. ä½¿ç”¨ `.get()` æ–¹æ³•é¿å… KeyError

```python
# âœ… æ¨è–¦ï¼šä½¿ç”¨ .get() æä¾›é è¨­å€¼
if not ibon_dict.get("played_sound_ticket", False):
    # ...
```

#### 2. ä¿æŒä¸€è‡´çš„å‘½åè¦ç¯„

```python
# å¹³å°å­—å…¸å‘½åï¼š{platform}_dict
ibon_dict = {}
tixcraft_dict = {}
kktix_dict = {}

# ç‹€æ…‹éµå‘½å
"played_sound_ticket"  # éšæ®µ 1
"played_sound_order"   # éšæ®µ 2
```

#### 3. æ·»åŠ é™¤éŒ¯è¨Šæ¯ï¼ˆå¯é¸ï¼‰

```python
if click_ret:
    if config_dict["advanced"]["play_sound"]["ticket"]:
        if not ibon_dict.get("played_sound_ticket", False):
            if show_debug_message:
                print("[SOUND] Playing ticket notification")  # â† é™¤éŒ¯è¨Šæ¯
            play_sound_while_ordering(config_dict)
            ibon_dict["played_sound_ticket"] = True
```

#### 4. ç¢ºä¿éŸ³æ•ˆæª”æ¡ˆå­˜åœ¨

```python
# åœ¨ç¨‹å¼å•Ÿå‹•æ™‚é©—è­‰éŸ³æ•ˆæª”æ¡ˆ
def validate_sound_file(config_dict):
    app_root = util.get_app_root()
    sound_file = os.path.join(
        app_root,
        config_dict["advanced"]["play_sound"]["filename"].strip()
    )
    if not os.path.exists(sound_file):
        print(f"[WARNING] Sound file not found: {sound_file}")
        return False
    return True
```

---

## ç¸½çµ

### æ ¸å¿ƒåŸå‰‡

1. **å…©éšæ®µç¨ç«‹**ï¼š`ticket` å’Œ `order` éŸ³æ•ˆæ˜¯ç¨ç«‹çš„å…©å€‹éšæ®µ
2. **è¨­å®šé©…å‹•**ï¼šæ‰€æœ‰éŸ³æ•ˆæ’­æ”¾å¿…é ˆæª¢æŸ¥å°æ‡‰çš„è¨­å®šåƒæ•¸
3. **é˜²é‡è¤‡æ’­æ”¾**ï¼šä½¿ç”¨ç¨ç«‹çš„ç‹€æ…‹æ¨™è¨˜é˜²æ­¢é‡è¤‡æ’­æ”¾
4. **ç‹€æ…‹é‡ç½®**ï¼šé›¢é–‹çµå¸³é é¢æ™‚é‡ç½®æ‰€æœ‰éŸ³æ•ˆç‹€æ…‹

### æª¢æŸ¥æ¸…å–®

åœ¨å¯¦ä½œéŸ³æ•ˆé€šçŸ¥æ™‚ï¼Œè«‹ç¢ºèªï¼š

- [ ] éšæ®µ 1 æª¢æŸ¥ `config_dict["advanced"]["play_sound"]["ticket"]`
- [ ] éšæ®µ 2 æª¢æŸ¥ `config_dict["advanced"]["play_sound"]["order"]`
- [ ] éšæ®µ 1 ä½¿ç”¨ `played_sound_ticket` æ¨™è¨˜
- [ ] éšæ®µ 2 ä½¿ç”¨ `played_sound_order` æ¨™è¨˜
- [ ] æ’­æ”¾å‰æª¢æŸ¥æ¨™è¨˜ç‹€æ…‹ï¼ˆé˜²é‡è¤‡ï¼‰
- [ ] æ’­æ”¾å¾Œç«‹å³è¨­å®šæ¨™è¨˜ç‚º `True`
- [ ] é›¢é–‹çµå¸³é é¢æ™‚é‡ç½®æ‰€æœ‰ç‹€æ…‹
- [ ] ä½¿ç”¨ `.get()` æ–¹æ³•é¿å… KeyError

---

## ç›¸é—œæ–‡ä»¶

- [é–‹ç™¼è¦ç¯„ (development_guide.md)](./development_guide.md)
- [ç¨‹å¼ç¢¼ç¯„æœ¬ (coding_templates.md)](./coding_templates.md)
- [å‡½å¼çµæ§‹åˆ†æ (structure.md)](./structure.md)
- [é‚è¼¯æµç¨‹åœ– (logic_flowcharts.md)](./logic_flowcharts.md)

---

**æ–‡ä»¶ç‰ˆæœ¬**ï¼šv1.0
**æœ€å¾Œæ›´æ–°**ï¼š2025-10-22
**ç¶­è­·è€…**ï¼šMaxBot é–‹ç™¼åœ˜éšŠ
