# CHANGELOG 編寫指南

## 目標讀者

CHANGELOG.md 的主要讀者是：
- **終端使用者**：想知道新版本有什麼新功能、修正了什麼問題
- **系統管理員**：評估是否需要升級、會不會影響現有配置
- **非開發人員**：想了解軟體能做什麼，而非怎麼做的

**不是**寫給開發人員看的技術文件（commit message、code review 才是開發者文件）

---

## 核心原則

### ✅ 應該寫什麼（使用者視角）

- **新功能**：使用者可以做什麼新的事情
- **問題修正**：什麼問題被解決了，使用者會感受到什麼改善
- **行為改變**：使用體驗有什麼不同
- **設定變更**：需要調整配置檔案嗎
- **相容性**：會不會影響現有使用方式

### ❌ 不該寫什麼（開發者視角）

- **函數名稱**：`click_button_via_cdp()`、`nodriver_ibon_auto_ocr()`
- **程式碼位置**：`nodriver_tixcraft.py:11002-11024`
- **實作細節**：使用什麼 API、什麼演算法、記憶體處理模式
- **技術術語**：DOM、CDP、DOMSnapshot、Shadow DOM、演算法、平坦化策略
- **技術問題**：UTF-8 編碼衝突、CP950 錯誤、死鎖問題
- **內部重構**：檔案重新組織、變數命名調整
- **測試結果**：單元測試通過、覆蓋率提升、通過 X 組測試、X 種視窗大小測試
- **技術規格細節**：具體解析度（如 1920x1080）、重試次數（如最多 19 次）、百分比數字（如 75-80% 可用度）
- **效能實作細節**：記憶體處理、檔案儲存機制、處理時間（如 10-50ms）

---

## 內容分級

### 🟢 必須記錄

- 新增搶票平台支援
- 新增主要功能（如驗證碼自動識別）
- 修正會影響搶票成功率的問題
- 設定檔格式變更
- 相容性破壞（需要使用者調整的改動）

### 🟡 選擇性記錄

- 效能改善（如果使用者能明顯感受）
- UI/UX 優化
- 輔助功能增強（如音效提醒）
- 文件更新（如果對使用者重要）

### 🔴 禁止記錄

- 函數簽名變更
- 變數重命名
- 程式碼重構（不影響功能）
- 內部錯誤處理改善（使用者無感）
- 開發工具更新（如 linter、formatter）
- 測試框架調整

---

## 格式範本

### 🌟 推薦格式（精簡列點式）

這是**最推薦**的格式，簡潔明瞭：

```markdown
## YYYY.MM.DD

- 新增功能或改善的簡短描述
- 修正問題的簡短描述
- 另一個新增功能
- 另一個問題修正
```

**範例（最佳實踐）：**
```markdown
## 2025.10.15

- 新增 KHAM 寬宏與 Ticket 年代平台的智慧座位選擇功能（支援 8 種舞台方位偏好）
- 新增 KHAM 登入頁面驗證碼自動識別與填寫功能
- 改善 ibon 平台搶票速度
- 改善 KHAM 平台日期與區域選擇邏輯
- 修正 KHAM 首頁無限循環問題
```

### 詳細格式（需要額外說明時使用）

當需要提供更多資訊時，可使用這種格式：

```markdown
## YYYY.MM.DD

### [平台名稱] 新增 [功能名稱]
- **說明**: 使用者現在可以做什麼
- **使用方式**: 如何啟用或使用（如果需要配置）
- **限制**: 有什麼已知限制或注意事項
```

**注意**：優先使用精簡列點式，只在需要詳細說明設定方式或重大變更時才使用詳細格式。

---

## 實際範例對照

### 範例 1：驗證碼功能

#### ❌ 過於技術化（不好）

```markdown
### NoDriver iBon OCR 驗證碼功能完成
- 新增驗證碼處理函數
- 使用 DOMSnapshot 穿透 closed Shadow DOM 獲取驗證碼圖片
- 使用 DOM.getDocument() 初始化文檔（支援頁面重載後使用）
- 修復 Windows UTF-8 編碼與檔案重定向衝突導致的死鎖
- 修復 DOMSnapshot 日期提取中的 CP950 編碼錯誤
- 新增 CDP 原生點擊方法使用滑鼠點擊 API
```

**問題**：充滿技術術語（DOMSnapshot、Shadow DOM、UTF-8、CP950、CDP），使用者看不懂也不需要知道

#### ✅ 使用者友善（好）

```markdown
- 新增 iBon 平台驗證碼自動識別功能（NoDriver 引擎）
- 新增 iBon 平台完整購票流程：日期選擇 → 區域選擇 → 票數填寫 → 驗證碼識別 → 結帳提醒
```

**優點**：簡潔說明使用者能做什麼，省略所有技術細節

---

### 範例 2：日期選擇

#### ❌ 過於技術化（不好）

```markdown
### NoDriver iBon 日期選擇功能增強
- 修復程式凍結問題（移除 NodeId 物件重複列舉）
- 修復 Windows UTF-8 編碼與檔案重定向衝突導致的死鎖（條件式啟用 UTF-8 wrapper）
- 修復 DOMSnapshot 日期提取中的 CP950 編碼錯誤（新增 try-except 保護）
```

**問題**：全是技術問題（NodeId、UTF-8、DOMSnapshot、CP950），使用者不關心

#### ✅ 使用者友善（好）

```markdown
- 新增 iBon 日期選擇支援多種格式（M/D、MM/DD、YY/MM/DD、YYYY/MM/DD）
- 修正 iBon 日期選擇時偶爾卡住的問題
```

**優點**：聚焦在「改善了什麼」、「支援什麼新格式」，技術細節省略

---

### 範例 3：座位選擇功能

#### ❌ 過於技術化（不好）

```markdown
### 年代與 KHAM 平台座位選擇演算法實作
- 實作座位選擇演算法，支援連續座位追蹤
- 加入 DOM 位置追蹤機制，處理複雜座位排列
- 使用真實 DOM 位置追蹤提升演算法準確度
- 修正演算法中的邊界條件處理問題
```

**問題**：充滿技術術語（演算法、DOM 位置追蹤、邊界條件），使用者不需要知道實作細節

#### ✅ 使用者友善（好）

```markdown
- 新增 KHAM 寬宏與 Ticket 年代平台的智慧座位選擇功能（支援 8 種舞台方位偏好）
- 修正 Ticket 年代平台座位選擇準確度
- 改善 KHAM 平台座位選擇邏輯，正確處理複雜座位排列
```

**優點**：說明「使用者能做什麼」（8 種舞台方位偏好）、「改善了什麼」（準確度、複雜排列），而非技術實作

---

### 範例 4：專案結構調整

#### ❌ 過於技術化（不好）

```markdown
### 專案目錄重構
- 將所有 .py 檔案移動到 src/ 目錄
- 更新所有 import 語句路徑
- 建立 assets/ 目錄並分離圖示和音效檔案
- 修正相對路徑引用問題
- 更新 PyInstaller 打包腳本
```

**問題**：這是內部重構，使用者不需要知道檔案移動了

#### ✅ 使用者友善（好）

```markdown
- 改善專案結構，所有程式碼和資源統一收納到 src/ 目錄
- 改善執行方式說明，提供從 src/ 或根目錄執行的清晰指令
```

**優點**：只說明對使用者有影響的部分（執行方式變更），省略內部細節

---

### 範例 5：文件更新

#### ❌ 過於技術化（不好）

```markdown
#### NoDriver API 指南重新整理
- 文件精簡優化（從 2165 行縮減至 796 行，減少 63%）
- 刪除重複的 Shadow DOM 操作範例
- 合併相似的最佳實踐章節
- 精簡 Cloudflare 處理說明
```

**問題**：這是內部文件重構，使用者不需要知道文件有幾行

#### ✅ 使用者友善（好）

```markdown
- 改善 NoDriver API 開發指南文件結構，新增 iBon 實作範例
```

**優點**：說明文件「變得更好用了」，而非技術細節

---

## 🚨 常見錯誤與修正

以下是實際專案中出現的不符合規範案例：

### 錯誤 1：暴露技術實作細節

#### ❌ 錯誤範例
```markdown
- 修正 Ticket 年代平台座位選擇演算法準確度（正確使用演算法選定的連續座位）
- 改善 Ticket 年代平台座位選擇邏輯（加入 DOM 位置追蹤，處理複雜座位排列）
- 修正 KHAM 平台座位選擇演算法（使用真實 DOM 位置追蹤提升準確度）
```

**問題**：「演算法」、「DOM 位置追蹤」是實作細節

#### ✅ 修正版本
```markdown
- 修正 Ticket 年代平台座位選擇準確度
- 改善 Ticket 年代平台座位選擇邏輯，正確處理複雜座位排列
- 修正 KHAM 平台座位選擇準確度
```

---

### 錯誤 2：包含函數名稱

#### ❌ 錯誤範例
```markdown
- 新增 nodriver_ibon_get_captcha_image_from_shadow_dom() 函數處理驗證碼
- 實作 nodriver_ticket_find_best_seats() 座位選擇邏輯
```

**問題**：函數名稱是開發者關注的，不是使用者關注的

#### ✅ 修正版本
```markdown
- 新增 iBon 平台驗證碼自動識別功能
- 新增 Ticket 年代平台智慧座位選擇功能
```

---

### 錯誤 3：過度強調技術術語

#### ❌ 錯誤範例
```markdown
- 使用 CDP (Chrome DevTools Protocol) 實作點擊
- 透過 DOMSnapshot API 穿透 closed Shadow DOM
- 實作 OCR 模型整合與重試機制
```

**問題**：CDP、DOMSnapshot、OCR 模型對使用者無意義

#### ✅ 修正版本
```markdown
- 改善按鈕點擊穩定性
- 改善頁面元素偵測準確度
- 改善驗證碼識別成功率
```

---

### 錯誤 4：列出測試結果

#### ❌ 錯誤範例
```markdown
- 通過 15 組測試案例驗證
- 座位選擇成功率達 95%
- 支援 3 種視窗大小測試
```

**問題**：測試結果是開發者關注的品質指標，不是使用者需要知道的

#### ✅ 修正版本
```markdown
- 改善座位選擇穩定性
- 修正多種螢幕解析度下的顯示問題
```

---

## 決策流程圖

使用以下問題判斷是否該寫入 CHANGELOG：

```
是否影響使用者體驗？
├─ 是 → 繼續下一題
└─ 否 → ❌ 不寫入 CHANGELOG（寫在 commit message）

使用者需要調整設定或操作嗎？
├─ 是 → ✅ 必須寫入，並說明如何調整
└─ 否 → 繼續下一題

使用者能明顯感受到差異嗎？
├─ 是 → ✅ 寫入，描述改善效果
└─ 否 → ❌ 不寫入（例如：內部重構、測試改善）

是否包含技術術語（DOM、API、演算法、CDP 等）？
├─ 是 → ❌ 重寫，改用使用者能理解的語言
└─ 否 → ✅ 寫入

能否用一句話向非技術人員解釋？
├─ 是 → ✅ 寫入
└─ 否 → ❌ 重新思考描述方式
```

---

## 編寫檢查清單

在提交 CHANGELOG 前，逐項檢查：

- [ ] 是否避免出現函數名稱、檔案路徑、程式碼行數？
- [ ] 是否避免技術術語（如 DOM、CDP、DOMSnapshot、演算法、平坦化）？
- [ ] 是否避免技術問題描述（如 UTF-8、CP950、編碼錯誤、死鎖）？
- [ ] 是否用「使用者可以做什麼」而非「程式做了什麼」描述？
- [ ] 是否說明影響範圍（哪個平台、哪個功能）？
- [ ] 設定變更是否有說明如何調整？
- [ ] 已知限制是否有提及？
- [ ] 非技術背景的人能看懂嗎？
- [ ] 能否用一句話向朋友解釋這個改動？
- [ ] 是否移除了測試結果和覆蓋率資訊？

---

## 特殊情況處理

### 破壞性變更

必須明確標示並說明升級步驟：

```markdown
### ⚠️ 破壞性變更：設定檔格式調整
- **變更**: `config.json` 中的 `date_auto_select` 改為 `date_selection`
- **升級步驟**:
  1. 備份現有 `config.json`
  2. 將 `date_auto_select` 改名為 `date_selection`
  3. 重新測試設定
- **原因**: 統一命名規範，避免混淆
```

### 安全性修正

不要透露技術細節，以免被惡意利用：

```markdown
### 安全性改善
- 修正可能導致資料外洩的問題
- 建議所有使用者升級至此版本
```

### 實驗性功能

明確標示實驗性質與風險：

```markdown
### 🧪 實驗性功能：AI 驗證碼辨識
- **說明**: 新增 AI 模型辨識驗證碼（準確率 85%）
- **啟用方式**: 在設定檔中設定 `experimental.ai_ocr: true`
- **注意**: 此功能仍在測試階段，可能影響搶票速度
- **回饋**: 歡迎回報辨識成功率與問題
```

---

## 新功能類型範例

### 智慧座位選擇功能

#### ✅ 正確寫法
```markdown
- 新增 KHAM 寬宏與 Ticket 年代平台的智慧座位選擇功能（支援 8 種舞台方位偏好）
- 支援自動選擇靠近舞台中央、左側、右側等偏好座位
```

#### ❌ 錯誤寫法
```markdown
- 實作座位選擇演算法，支援 8 種方位計算
- 使用 DOM 節點位置追蹤實作最佳座位查找邏輯
```

---

### 多平台同步更新

#### ✅ 正確寫法
```markdown
- 改善 TixCraft、KKTIX、TicketPlus、iBon 四大平台的核心搶票流程
- 改善 NoDriver 引擎在所有支援平台的穩定性
```

#### ❌ 錯誤寫法
```markdown
- 重構四大平台的共用函數邏輯
- 統一 NoDriver 版本的錯誤處理機制
```

---

### 專案結構調整

#### ✅ 正確寫法（只在影響使用者時才記錄）
```markdown
- 改善執行方式說明，提供從 src/ 或根目錄執行的清晰指令
```

#### ❌ 錯誤寫法（內部重構不該記錄）
```markdown
- 將所有程式碼移動到 src/ 目錄
- 更新所有 import 路徑
- 重組資源檔案目錄結構
```

---

## 總結

**記住**：CHANGELOG 是寫給使用者看的產品更新說明，不是開發日誌。

- **好的 CHANGELOG**: 「iBon 現在支援驗證碼自動識別，購票流程更順暢」
- **不好的 CHANGELOG**: 「新增 OCR 處理函數使用 DOMSnapshot API 穿透 Shadow DOM」

技術細節屬於 commit message、code review、開發文件，不屬於 CHANGELOG。

**寫作技巧**：
1. 想像你在向不懂技術的朋友解釋
2. 聚焦「使用者能做什麼」、「體驗改善了什麼」
3. 省略所有「如何實現」的技術細節
4. 避免任何需要查文件才能理解的術語

---

*最後更新：2025-10-17*
