# Q4 æ·±å…¥åˆ†æï¼šé—œéµå­—è§£æå›é€€é‚è¼¯

**åˆ†ææ—¥æœŸ**ï¼š2025-12-18
**åˆ†æç›®çš„**ï¼šæ±ºå®š `parse_keyword_string_to_array()` çš„å›é€€ç­–ç•¥

---

## ä¸€ã€25 è™• json.loads å›é€€é‚è¼¯åˆ†é¡

### é¡å‹ 1ï¼šç„¡å›é€€ï¼ˆè§£æå¤±æ•—è¨­ç‚ºç©ºé™£åˆ—ï¼‰- 11 è™•

| è¡Œè™Ÿ | å¹³å° | å›é€€è¡Œç‚º | å‚™è¨» |
|------|------|---------|------|
| 1649 | KKTIX æ—¥æœŸ | ç„¡ try-except | å¤–å±¤å·²åŒ…è£¹ |
| 3770 | TicketMaster æ—¥æœŸ | ç„¡ try-except | å¤–å±¤å·²åŒ…è£¹ |
| 4778 | TixCraft æ—¥æœŸ | ç„¡ try-except | å¤–å±¤å·²åŒ…è£¹ |
| 5037 | TixCraft å€åŸŸ | `[]` | æ¨™æº–è™•ç† |
| 5463 | TixCraft å€åŸŸ2 | `[]` | æ¨™æº–è™•ç† |
| 6783 | TicketPlus æ—¥æœŸ | ç„¡ try-except | å¤–å±¤å·²åŒ…è£¹ |
| 10669 | iBon æ—¥æœŸ Pierce | `[]` | æ¨™æº–è™•ç† |
| 11016 | iBon æ—¥æœŸ DOM | `[]` | æ¨™æº–è™•ç† |
| 16508 | Cityline æ—¥æœŸ | ç„¡ try-except | å¤–å±¤å·²åŒ…è£¹ |
| 17346 | KHAM å€åŸŸ | `[]` | æ¨™æº–è™•ç† |
| 17982 | UDN æ—¥æœŸ | `[]` | + format_keyword_string |

### é¡å‹ 2ï¼šé€—è™Ÿåˆ†å‰²å›é€€ - 5 è™•

| è¡Œè™Ÿ | å¹³å° | å›é€€è¡Œç‚º |
|------|------|---------|
| 9746 | FamiTicket æ—¥æœŸ | `keyword.split(',')` |
| 22988 | HKTicketing å€åŸŸ | `keyword.split(',')` |
| 23921 | HKTicketing æ—¥æœŸ2 | `keyword.split(',')` |
| 24064 | HKTicketing å€åŸŸ2 | `keyword.split(',')` |

### é¡å‹ 3ï¼šåˆ†è™Ÿåˆ†å‰²å›é€€ï¼ˆIssue #23ï¼‰- 2 è™•

| è¡Œè™Ÿ | å¹³å° | å›é€€è¡Œç‚º |
|------|------|---------|
| 7049 | TixCraft æ’é™¤ | JSON â†’ åˆ†è™Ÿ â†’ å–®ä¸€å€¼ï¼ˆ3 ç´šï¼‰ |
| 18740 | UDN æ’é™¤ | JSON â†’ åˆ†è™Ÿ â†’ å–®ä¸€å€¼ï¼ˆ3 ç´šï¼‰ |

### é¡å‹ 4ï¼šåŸå§‹å€¼å›é€€ - 1 è™•

| è¡Œè™Ÿ | å¹³å° | å›é€€è¡Œç‚º |
|------|------|---------|
| 8869 | TicketPlus å€åŸŸ | `[area_keyword_raw]` |

### é¡å‹ 5ï¼šæœ‰é¡å¤–å¾Œè™•ç† - 4 è™•

| è¡Œè™Ÿ | å¹³å° | å¾Œè™•ç† |
|------|------|--------|
| 3921 | TicketMaster å€åŸŸ | é€—è™Ÿæª¢æ¸¬å†åˆ†å‰² |
| 17982 | UDN æ—¥æœŸ | `format_keyword_string()` |
| 18066 | UDN æ—¥æœŸ2 | `format_keyword_string()` |
| 18176 | UDN å€åŸŸ | `format_keyword_string()` |

---

## äºŒã€å›é€€é‚è¼¯ä»£ç¢¼å°æ¯”

### æœ€ç°¡å–®ï¼ˆé¡å‹ 1ï¼‰
```python
try:
    keyword_array = json.loads("[" + keyword + "]")
except:
    keyword_array = []
```

### é€—è™Ÿå›é€€ï¼ˆé¡å‹ 2ï¼‰
```python
try:
    keyword_sets = json.loads("[" + keyword + "]")
except:
    keyword_sets = [kw.strip() for kw in keyword.split(',') if kw.strip()]
```

### åˆ†è™Ÿå›é€€ï¼ˆé¡å‹ 3 - æœ€å®Œæ•´ï¼‰
```python
try:
    keywords = json.loads("[" + keyword + "]")
except:
    if util.CONST_KEYWORD_DELIMITER in keyword:  # åˆ†è™Ÿ
        keywords = [kw.strip() for kw in keyword.split(util.CONST_KEYWORD_DELIMITER)]
    else:
        keywords = [keyword.strip()] if keyword.strip() else []
```

### åŸå§‹å€¼å›é€€ï¼ˆé¡å‹ 4ï¼‰
```python
try:
    keyword_array = json.loads("[" + keyword + "]")
except:
    keyword_array = [keyword] if keyword else []
```

---

## ä¸‰ã€ç›¸å®¹æ€§å½±éŸ¿åˆ†æ

### é¸é … Aï¼šåŒ…å«å®Œæ•´ 3 ç´šå›é€€

**å„ªé»**ï¼š
- èˆ‡é¡å‹ 3ï¼ˆL7049, L18740ï¼‰å®Œå…¨ä¸€è‡´
- æ”¯æ´ Issue #23 çš„åˆ†è™Ÿåˆ†éš”ç¬¦
- æœ€å¤§ç¨‹åº¦é˜²æ­¢è§£æå¤±æ•—

**ç¼ºé»**ï¼š
- èˆ‡é¡å‹ 1ï¼ˆ11 è™•ï¼‰è¡Œç‚ºä¸åŒï¼šåŸæœ¬è¿”å› `[]`ï¼Œç¾åœ¨æœƒå˜—è©¦åˆ†å‰²
- å¯èƒ½ç”¢ç”Ÿéé æœŸçµæœï¼ˆå¦‚ä½¿ç”¨è€…è¼¸å…¥åŒ…å«åˆ†è™Ÿä½†éåˆ†éš”ç”¨é€”ï¼‰

**ç›¸å®¹æ€§é¢¨éšª**ï¼šğŸŸ¡ ä¸­

### é¸é … Bï¼šåƒ…åŸºç¤å›é€€ï¼ˆè¿”å›ç©ºé™£åˆ—ï¼‰

**å„ªé»**ï¼š
- èˆ‡é¡å‹ 1ï¼ˆ11 è™•ï¼‰å®Œå…¨ç›¸å®¹
- ç°¡æ½”ï¼Œä¸æ”¹è®Šç¾æœ‰è¡Œç‚º
- è®“æœ‰ç‰¹æ®Šéœ€æ±‚çš„ä½ç½®ä¿ç•™è‡ªè¨‚å›é€€

**ç¼ºé»**ï¼š
- ç„¡æ³•çµ±ä¸€é¡å‹ 2-4 çš„ä½ç½®

**ç›¸å®¹æ€§é¢¨éšª**ï¼šğŸŸ¢ ä½

### é¸é … Cï¼šå¯é…ç½®å›é€€æ¨¡å¼

**å„ªé»**ï¼š
- æœ€å¤§å½ˆæ€§
- å¯é€æ­¥é·ç§»

**ç¼ºé»**ï¼š
- å¢åŠ è¤‡é›œåº¦
- å‡½å¼ç°½åè®Šé•·

**ç›¸å®¹æ€§é¢¨éšª**ï¼šğŸŸ¢ ä½

---

## å››ã€å»ºè­°

### æ¨è–¦ï¼šé¸é … Bï¼ˆåƒ…åŸºç¤å›é€€ï¼‰

**ç†ç”±**ï¼š

1. **æœ€å¤§ç›¸å®¹æ€§**ï¼š11/25ï¼ˆ44%ï¼‰çš„ä½ç½®ä½¿ç”¨ç©ºé™£åˆ—å›é€€ï¼Œé€™æ˜¯æœ€å¤§çš„ç¾¤é«”

2. **ä¿æŒç°¡æ½”**ï¼š
   ```python
   def parse_keyword_string_to_array(keyword_string):
       if not keyword_string or not keyword_string.strip():
           return []
       try:
           return json.loads("[" + keyword_string + "]")
       except:
           return []
   ```

3. **ä¸ç ´å£ç¾æœ‰é‚è¼¯**ï¼šæœ‰è‡ªè¨‚å›é€€çš„ä½ç½®ï¼ˆé¡å‹ 2-4ï¼‰å¯ä»¥ç¹¼çºŒä½¿ç”¨è‡ªè¨‚é‚è¼¯ï¼š
   ```python
   # ç¾æœ‰ä»£ç¢¼ä¿æŒ
   keywords = util.parse_keyword_string_to_array(keyword)
   if not keywords:
       # è‡ªè¨‚å›é€€
       keywords = [kw.strip() for kw in keyword.split(',') if kw.strip()]
   ```

4. **æ¼¸é€²å¼æ”¹é€²**ï¼šæœªä¾†å¯æ–°å¢ `parse_keyword_string_to_array_with_fallback()` æ”¯æ´å®Œæ•´å›é€€

---

## äº”ã€æ›¿æ›è¨ˆç•«

### ç¬¬ä¸€æ‰¹æ›¿æ›ï¼ˆç„¡ç‰¹æ®Šè™•ç†ï¼‰- 17 è™•

å¯ç›´æ¥æ›¿æ›ç‚º `util.parse_keyword_string_to_array(keyword)`ï¼š
- L5037, L5463, L10669, L11016, L17346ï¼ˆé¡å‹ 1ï¼‰
- L9746, L22988, L23921, L24064ï¼ˆé¡å‹ 2 - éœ€ä¿ç•™è‡ªè¨‚å›é€€ï¼‰

### ç¬¬äºŒæ‰¹æ›¿æ›ï¼ˆè§€å¯Ÿå¾Œï¼‰- 8 è™•

éœ€è¦è§€å¯Ÿç¬¬ä¸€æ‰¹å¾Œå†æ±ºå®šï¼š
- L1649, L3770, L4778, L6783, L16508ï¼ˆç„¡ try-exceptï¼‰
- L3921, L17982, L18066, L18176ï¼ˆæœ‰é¡å¤–å¾Œè™•ç†ï¼‰
