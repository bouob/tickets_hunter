# 重構分析報告：執行摘要

**日期**：2025-12-18
**分析範圍**：`src/util.py` + `src/nodriver_tixcraft.py`
**分析目的**：識別可重構為共用函式的重複模式

---

## 核心發現

### 1. 高優先級重構機會

| 模式 | 出現次數 | 預估節省行數 | 風險等級 |
|------|----------|--------------|----------|
| 關鍵字解析 `json.loads("[" + keyword + "]")` | **25 處** | 75+ | 低 |
| 設定讀取 `show_debug_message` | **80+ 處** | 160+ | 低 |
| 選擇模式 4 分支邏輯 | **15+ 處** | 120+ | 低 |
| 日期/區域設定區塊讀取 | **55+ 處** | 165+ | 中 |

### 2. 已識別的重複代碼總覽

- **config_dict 存取**：470+ 次，6 種不同存取模式
- **選擇模式邏輯**：50+ 處，4 種不同實作方式
- **關鍵字匹配邏輯**：19 處 JSON 解析，34 處格式化
- **排除關鍵字檢查**：23 處調用

### 3. util.py 現有共用函式統計

- **總函式數**：62 個
- **高頻使用**：6 個核心函式
- **可擴展**：3 個建議新增函式

---

## 建議新增共用函式（依優先級）

### P0 - 立即實作

1. **`get_debug_mode(config_dict)`** - 統一 debug 模式讀取
2. **`parse_keyword_string(keyword)`** - 統一關鍵字解析

### P1 - 短期實作

3. **`get_date_select_config(config_dict)`** - 日期選擇設定讀取
4. **`get_area_select_config(config_dict)`** - 區域選擇設定讀取
5. **`match_keyword_with_text(keyword, text, mode)`** - 統一匹配邏輯

### P2 - 長期考慮

6. **`ConfigHelper` 類別** - 完整設定讀取封裝
7. **`KeywordMatcher` 類別** - 關鍵字匹配引擎

---

## 風險評估

| 重構項目 | 影響範圍 | 測試需求 | 建議策略 |
|---------|---------|---------|---------|
| debug 模式統一 | 全平台 | 低 | 直接替換 |
| 關鍵字解析統一 | 全平台 | 中 | 漸進式替換 |
| 選擇模式統一 | 已完成 | 低 | ✅ 已實作 |
| 設定讀取統一 | 全平台 | 高 | 分階段進行 |

---

## 下一步行動

1. 閱讀詳細分析報告（各子報告）
2. 決定重構優先級
3. 逐步實作並測試

**詳細報告**：見 `.temp/refactor-analysis/` 目錄下其他檔案
