# doc - 文件表頭規格處理

統一處理 `docs/` 和 `guide/` 目錄下所有文件的表頭格式

## 使用時機
- 建立新的 `.md` 文件（在 `docs/` 或 `guide/` 下）
- 更新文件內容後需要刷新日期
- 批次檢查表頭格式一致性

## 適用範圍
- ✅ `docs/**/*.md` - 開發文件（使用 **明顯表頭**）
- ✅ `guide/**/*.md` - 使用者手冊（使用 **HTML 註解表頭**）
- ❌ 其他目錄（如 `specs/`, `CLAUDE.md`, `README.md` 等）

## 表頭規範

### docs/ 目錄：標準格式（明顯表頭）
```markdown
# 文件標題

**文件說明**：[簡短描述這份文件的目的與內容]
**最後更新**：YYYY-MM-DD

---

[文件正文開始...]
```

### guide/ 目錄：HTML 註解格式（隱藏表頭）
```markdown
<!--
文件說明：[簡短描述這份文件的目的與內容]
最後更新：YYYY-MM-DD
-->

# 文件標題

[文件正文開始...]
```

**原因**：`guide/` 文件會放在 GitHub 上供使用者閱讀，使用 HTML 註解可以：
- 保留元資料供開發者參考
- 在 GitHub 渲染時不會顯示表頭（更乾淨）
- 使用者只看到標題和內容

### 欄位說明
1. **文件說明**：
   - 1-2 句話說明文件用途
   - 使用繁體中文
   - 明確、具體、有意義

2. **最後更新**：
   - 格式：`YYYY-MM-DD`（例：2025-11-12）
   - 來源：從 `<env>` 標籤中的 `Today's date` 取得
   - 每次文件內容修改都要更新

3. **分隔線**（僅 docs/ 需要）：
   - 使用 `---` 分隔表頭與正文
   - guide/ 不需要（HTML 註解本身就是分隔）

## 處理流程

### 1. 建立新文件時

**docs/ 目錄**：
```markdown
# [標題]

**文件說明**：[AI 根據內容生成描述]
**最後更新**：2025-11-12

---

[新內容]
```

**guide/ 目錄**：
```markdown
<!--
文件說明：[AI 根據內容生成描述]
最後更新：2025-11-12
-->

# [標題]

[新內容]
```

### 2. 更新現有文件時
- 讀取文件前 20 行，檢查是否有表頭
- 判斷文件所屬目錄（docs/ 或 guide/）
- **如果沒有表頭**：
  - **docs/**：在 `# 標題` 之後插入明顯表頭
  - **guide/**：在文件最開頭插入 HTML 註解表頭
- **如果有表頭**：
  - 更新「最後更新」日期為今天（從 `<env>` 取得）
  - 檢查「文件說明」是否存在且有意義
  - 確保格式符合該目錄的規範
- **如果格式錯誤**（例如 guide/ 使用明顯表頭）：
  - 轉換為正確格式
  - 保留原有資訊

### 3. 批次檢查時
- 掃描所有 `docs/**/*.md` 和 `guide/**/*.md`
- 分別檢查各目錄的格式規範：
  - **docs/**：檢查明顯表頭格式
  - **guide/**：檢查 HTML 註解格式
- 回報缺少表頭或格式不符的文件
- 提供修正建議（明確指出應使用哪種格式）

## 範例

### ✅ 正確範例（docs/02-development/structure.md）
```markdown
# 程式結構與函數索引

**文件說明**：提供 Tickets Hunter 專案的模組結構、核心函數索引與平台實作分析
**最後更新**：2025-11-12

---

## 概述
本文件詳細記錄...
```

### ✅ 正確範例（guide/setup-guide.md）
```markdown
<!--
文件說明：協助使用者完成 Tickets Hunter 的初次安裝與設定
最後更新：2025-11-12
-->

# 環境設定指南

## 系統需求
...
```

### ❌ 錯誤範例 1（docs/ 缺少表頭）
```markdown
# 程式結構與函數索引

## 概述
本文件詳細記錄...
```

### ❌ 錯誤範例 2（guide/ 使用明顯表頭）
```markdown
# 環境設定指南

**文件說明**：協助使用者完成安裝
**最後更新**：2025-11-12

---

## 系統需求
...
```
**問題**：guide/ 應該使用 HTML 註解格式

### ❌ 錯誤範例 3（格式錯誤）
```markdown
# 程式結構與函數索引

更新日期: 2025/11/12  ← 格式錯誤
說明: 程式結構  ← 欄位名稱錯誤

## 概述
...
```

## 執行動作清單

當呼叫 `doc` skill 時，按以下步驟執行：

1. **確認檔案路徑**
   - 檢查是否在 `docs/` 或 `guide/` 目錄下
   - 如果不是，拒絕處理並提示
   - **判斷目錄類型**（影響表頭格式）：
     - `docs/` → 使用明顯表頭
     - `guide/` → 使用 HTML 註解表頭

2. **讀取文件**
   - 讀取前 20 行（表頭通常在此範圍）
   - 識別是否已有表頭結構
   - 識別現有表頭類型（明顯 vs HTML 註解）

3. **驗證表頭**
   - **docs/ 文件**：
     - 檢查「**文件說明**：」欄位
     - 檢查「**最後更新**：」欄位
     - 檢查 `---` 分隔線
   - **guide/ 文件**：
     - 檢查 `<!-- ... -->` HTML 註解區塊
     - 檢查註解內的「文件說明：」和「最後更新：」

4. **更新或建立**
   - **有正確格式表頭**：
     - 只更新「最後更新」為今天日期（從 `<env>` 取得）
   - **無表頭或格式錯誤**：
     - 生成有意義的「文件說明」（根據文件標題和內容）
     - 根據目錄類型插入對應格式表頭
     - **docs/**：在 `# 標題` 之後插入明顯表頭
     - **guide/**：在文件最開頭插入 HTML 註解表頭（在 `# 標題` 之前）

5. **確認變更**
   - 顯示修改前後對比
   - 確保無破壞性變更
   - 確保格式符合目錄規範

## 特殊考量

### guide/ 目錄（使用者手冊）
- 文件說明要**使用者友善**（避免技術術語）
- 描述「這份指南幫助你做什麼」而非「這份文件記錄什麼」
- 範例：
  - ✅ 「協助使用者完成初次安裝與設定」
  - ❌ 「記錄安裝流程的技術文件」

### docs/ 目錄（開發文件）
- 文件說明可以使用技術術語
- 描述文件的技術範圍與目的
- 範例：
  - ✅ 「提供 NoDriver API 的選擇器優化策略與效能分析」
  - ✅ 「記錄 12 階段搶票自動化標準的設計原則與實作檢查清單」

## 不處理的情況

明確拒絕處理以下文件：
- `CLAUDE.md` - 有自己的表頭規範
- `README.md` - 專案首頁，格式特殊
- `CHANGELOG.md` - 由 `/gchange` 管理
- `specs/**/*.md` - 規格文件有自己的格式
- `.specify/**/*.md` - speckit 系統文件

## 遵循的憲法原則

- **憲法第 VIII 條**：文件與代碼同步（文件是代碼的一部分）
- **憲法第 II 條**：資料結構優先（統一的表頭格式是良好結構）
- **語言規範**：繁體中文、台灣語感

## 使用範例

### 範例 1：更新 docs/ 文件表頭
```
使用者：「用 doc skill 更新 docs/02-development/structure.md 的表頭」
Claude：
  1. 讀取文件前 20 行
  2. 檢測到是 docs/ 目錄 → 使用明顯表頭格式
  3. 發現已有表頭，更新「最後更新」為 2025-11-12
  4. 完成
```

### 範例 2：為 guide/ 文件添加表頭
```
使用者：「用 doc skill 為 guide/setup-guide.md 添加表頭」
Claude：
  1. 讀取文件
  2. 檢測到是 guide/ 目錄 → 使用 HTML 註解格式
  3. 生成文件說明：「協助使用者完成 Tickets Hunter 的初次安裝與設定」
  4. 在文件最開頭插入 HTML 註解表頭
  5. 完成
```

### 範例 3：建立新文件（自動觸發）
```
使用者：「幫我建立 docs/09-new-feature/implementation.md」
Claude：
  1. 判斷是 docs/ 目錄 → 自動呼叫 doc skill
  2. 建立文件時插入明顯表頭
  3. 完成
```

### 範例 4：批次檢查格式
```
使用者：「用 doc skill 檢查所有文件的表頭格式」
Claude：
  1. 掃描 docs/**/*.md（檢查明顯表頭）
  2. 掃描 guide/**/*.md（檢查 HTML 註解表頭）
  3. 回報：
     - ✅ docs/02-development/structure.md - 格式正確
     - ❌ guide/setup-guide.md - 缺少表頭（建議添加 HTML 註解）
     - ⚠️ guide/advanced.md - 使用錯誤格式（明顯表頭），應改為 HTML 註解
```

### 範例 5：修正格式錯誤
```
使用者：「guide/setup-guide.md 使用了明顯表頭，請修正」
Claude：
  1. 讀取現有明顯表頭內容
  2. 轉換為 HTML 註解格式
  3. 移除 `---` 分隔線（guide/ 不需要）
  4. 保留文件說明和日期資訊
  5. 完成轉換
```
