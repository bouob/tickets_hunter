---
description: "根據使用者需求，為當前功能產生一份自訂檢查清單。"
model: opus
scripts:
  sh: scripts/bash/check-prerequisites.sh --json
  ps: scripts/powershell/check-prerequisites.ps1 -Json
---

## 檢查清單目的：「英文的單元測試」

**關鍵概念**：檢查清單是 **需求撰寫的單元測試** — 它們驗證特定領域中需求的品質、清晰度和完整性。

**不是** 用於驗證/測試：

- ❌ 不是「驗證按鈕點擊是否正確」
- ❌ 不是「測試錯誤處理是否運作」
- ❌ 不是「確認 API 回傳 200」
- ❌ 不是檢查程式碼/實作是否符合規格

**用於** 需求品質驗證：

- ✅「所有卡片類型是否定義了視覺層級需求？」（完整性）
- ✅「『顯眼顯示』是否以具體的尺寸/定位量化？」（清晰度）
- ✅「所有互動元素的懸停狀態需求是否一致？」（一致性）
- ✅「是否定義了鍵盤導覽的無障礙需求？」（覆蓋範圍）
- ✅「規格是否定義了當 logo 圖片載入失敗時會發生什麼？」（邊界案例）

**比喻**：如果您的規格是用英文寫的程式碼，檢查清單就是它的單元測試套件。您是在測試需求是否撰寫良好、完整、明確無歧義，並且已準備好實作——而不是測試實作是否運作。

## 使用者輸入

```text
$ARGUMENTS
```

您 **必須** 在繼續之前考量使用者輸入（如非空白）。

## 執行步驟

1. **設定**：從儲存庫根目錄執行 `.specify/scripts/powershell/check-prerequisites.ps1 -Json`，並解析 JSON 以取得 FEATURE_DIR 和 AVAILABLE_DOCS 清單。
   - 所有檔案路徑必須為絕對路徑。
   - 對於參數中的單引號（如 "I'm Groot"），使用跳脫語法：例如 'I'\''m Groot'（或盡可能使用雙引號："I'm Groot"）。

2. **釐清意圖（動態）**：導出最多三個初始的情境釐清問題（無預設目錄）。這些問題必須：
   - 從使用者的措辭 + 從規格/計畫/任務擷取的訊號產生
   - 只詢問會實質改變檢查清單內容的資訊
   - 如果在 `$ARGUMENTS` 中已明確無歧義，則個別跳過
   - 偏好精確而非廣度

   產生演算法：
   1. 擷取訊號：功能領域關鍵字（例如，auth、latency、UX、API）、風險指標（「critical」、「must」、「compliance」）、利害關係人提示（「QA」、「review」、「security team」）、以及明確的交付項目（「a11y」、「rollback」、「contracts」）。
   2. 將訊號分群為候選焦點領域（最多 4 個），按相關性排名。
   3. 識別可能的受眾與時機（作者、審查者、QA、發布），如未明確說明。
   4. 偵測缺失的維度：範圍廣度、深度/嚴謹度、風險重點、排除邊界、可衡量的驗收標準。
   5. 從這些原型中制定問題：
      - 範圍細化（例如，「這應該包括與 X 和 Y 的整合接觸點，還是限於本地模組正確性？」）
      - 風險優先排序（例如，「這些潛在風險領域中，哪些應該接受強制關卡檢查？」）
      - 深度校準（例如，「這是輕量級的提交前健全性清單，還是正式的發布關卡？」）
      - 受眾框架（例如，「這將僅由作者使用，還是由同儕在 PR 審查期間使用？」）
      - 邊界排除（例如，「我們是否應該明確排除本輪的效能調校項目？」）
      - 情境類別缺口（例如，「未偵測到復原流程——回滾/部分失敗路徑是否在範圍內？」）

   問題格式規則：
   - 如果呈現選項，產生具有欄位的精簡表格：選項 | 候選 | 重要性
   - 限制最多 A–E 選項；如果自由形式的答案更清楚，則省略表格
   - 永不要求使用者重述他們已說過的內容
   - 避免推測性類別（不要虛構）。如果不確定，明確詢問：「確認 X 是否在範圍內。」

   無法互動時的預設值：
   - 深度：標準
   - 受眾：審查者（PR），如果與程式碼相關；否則為作者
   - 焦點：前 2 個相關性群集

   輸出問題（標記 Q1/Q2/Q3）。回答後：如果 ≥2 個情境類別（替代/例外/復原/非功能領域）仍不清楚，您**可以**再提出最多兩個針對性的後續問題（Q4/Q5），每個附帶一行理由（例如，「未解決的復原路徑風險」）。總共不要超過五個問題。如果使用者明確拒絕更多問題，則跳過升級。

3. **理解使用者請求**：結合 `$ARGUMENTS` + 釐清答案：
   - 導出檢查清單主題（例如，security、review、deploy、ux）
   - 整合使用者提到的明確必備項目
   - 將焦點選擇對應到類別框架
   - 從規格/計畫/任務推斷任何缺失的環境（不要虛構）

4. **載入功能環境**：從 FEATURE_DIR 讀取：
   - spec.md：功能需求和範圍
   - plan.md（如存在）：技術細節、相依性
   - tasks.md（如存在）：實作任務

   **環境載入策略**：
   - 僅載入與活躍焦點領域相關的必要部分（避免完整檔案傾倒）
   - 偏好將長章節摘要成精簡的情境/需求條目
   - 使用漸進式揭露：僅在偵測到缺口時新增後續擷取
   - 如果來源文件很大，產生臨時摘要項目而非嵌入原始文字

5. **產生檢查清單** - 建立「需求的單元測試」：
   - 如果不存在，建立 `FEATURE_DIR/checklists/` 目錄
   - 產生唯一的檢查清單檔名：
     - 根據領域使用簡短、描述性的名稱（例如，`ux.md`、`api.md`、`security.md`）
     - 格式：`[domain].md`
     - 如果檔案存在，附加到現有檔案
   - 從 CHK001 開始依序編號項目
   - 每次 `/speckit.checklist` 執行都會建立一個**新**檔案（永不覆寫現有檢查清單）

   **核心原則 - 測試需求，而非實作**：
   每個檢查清單項目必須評估**需求本身**的：
   - **完整性**：是否存在所有必要的需求？
   - **清晰度**：需求是否明確且具體？
   - **一致性**：需求是否彼此對齊？
   - **可衡量性**：需求是否可客觀驗證？
   - **覆蓋範圍**：是否涵蓋所有情境/邊界案例？

   **類別結構** - 按需求品質維度分組項目：
   - **需求完整性**（是否記錄了所有必要的需求？）
   - **需求清晰度**（需求是否具體且明確？）
   - **需求一致性**（需求是否對齊而無衝突？）
   - **驗收標準品質**（成功標準是否可衡量？）
   - **情境覆蓋**（是否涵蓋所有流程/案例？）
   - **邊界案例覆蓋**（是否定義了邊界條件？）
   - **非功能需求**（效能、安全性、無障礙等——是否已指定？）
   - **相依性與假設**（是否已記錄並驗證？）
   - **模糊與衝突**（什麼需要釐清？）

   **如何撰寫檢查清單項目 - 「英文的單元測試」**：

   ❌ **錯誤**（測試實作）：
   - 「驗證登陸頁面顯示 3 張節目卡片」
   - 「測試桌面上的懸停狀態是否運作」
   - 「確認點擊 logo 會導覽到首頁」

   ✅ **正確**（測試需求品質）：
   - 「是否指定了精選節目的確切數量和佈局？」[完整性]
   - 「『顯眼顯示』是否以具體的尺寸/定位量化？」[清晰度]
   - 「所有互動元素的懸停狀態需求是否一致？」[一致性]
   - 「是否定義了所有互動式 UI 的鍵盤導覽需求？」[覆蓋範圍]
   - 「是否指定了當 logo 圖片載入失敗時的後備行為？」[邊界案例]
   - 「是否定義了非同步節目資料的載入狀態？」[完整性]
   - 「規格是否定義了競爭 UI 元素的視覺層級？」[清晰度]

   **項目結構**：
   每個項目應遵循此模式：
   - 詢問需求品質的問題格式
   - 專注於規格/計畫中**寫了什麼**（或沒寫什麼）
   - 在括號中包含品質維度 [完整性/清晰度/一致性/等]
   - 檢查現有需求時參考規格章節 `[Spec §X.Y]`
   - 檢查缺失需求時使用 `[Gap]` 標記

   **按品質維度的範例**：

   完整性：
   - 「是否定義了所有 API 失敗模式的錯誤處理需求？[Gap]」
   - 「是否為所有互動元素指定了無障礙需求？[完整性]」
   - 「是否定義了響應式佈局的行動裝置斷點需求？[Gap]」

   清晰度：
   - 「『快速載入』是否以具體的時間門檻量化？[清晰度, Spec §NFR-2]」
   - 「『相關節目』的選擇標準是否明確定義？[清晰度, Spec §FR-5]」
   - 「『顯眼』是否以可衡量的視覺屬性定義？[模糊, Spec §FR-4]」

   一致性：
   - 「所有頁面的導覽需求是否對齊？[一致性, Spec §FR-10]」
   - 「登陸頁面和詳細頁面之間的卡片元件需求是否一致？[一致性]」

   覆蓋範圍：
   - 「是否定義了零狀態情境（無節目）的需求？[覆蓋範圍, 邊界案例]」
   - 「是否涵蓋了並發使用者互動情境？[覆蓋範圍, Gap]」
   - 「是否指定了部分資料載入失敗的需求？[覆蓋範圍, 例外流程]」

   可衡量性：
   - 「視覺層級需求是否可衡量/可測試？[驗收標準, Spec §FR-1]」
   - 「『平衡的視覺權重』是否可客觀驗證？[可衡量性, Spec §FR-2]」

   **情境分類與覆蓋**（需求品質焦點）：
   - 檢查是否存在以下需求：主要、替代、例外/錯誤、復原、非功能情境
   - 對於每個情境類別，詢問：「[情境類型] 需求是否完整、清晰且一致？」
   - 如果情境類別缺失：「[情境類型] 需求是故意排除還是缺失？[Gap]」
   - 當發生狀態變動時，包含韌性/回滾：「是否定義了遷移失敗的回滾需求？[Gap]」

   **可追溯性需求**：
   - 最低要求：≥80% 的項目必須包含至少一個可追溯性參考
   - 每個項目應參考：規格章節 `[Spec §X.Y]`，或使用標記：`[Gap]`、`[模糊]`、`[衝突]`、`[假設]`
   - 如果沒有 ID 系統：「是否建立了需求和驗收標準的 ID 方案？[可追溯性]」

   **浮現與解決問題**（需求品質問題）：
   詢問關於需求本身的問題：
   - 模糊：「『快速』一詞是否以具體指標量化？[模糊, Spec §NFR-1]」
   - 衝突：「§FR-10 和 §FR-10a 之間的導覽需求是否衝突？[衝突]」
   - 假設：「『隨時可用的 podcast API』假設是否已驗證？[假設]」
   - 相依性：「外部 podcast API 需求是否已記錄？[相依性, Gap]」
   - 缺失定義：「『視覺層級』是否以可衡量的標準定義？[Gap]」

   **內容整合**：
   - 軟上限：如果原始候選項目 > 40，按風險/影響排定優先順序
   - 合併檢查相同需求面向的近乎重複項目
   - 如果 >5 個低影響邊界案例，建立一個項目：「需求中是否涵蓋了邊界案例 X、Y、Z？[覆蓋範圍]」

   **🚫 絕對禁止** - 這些會讓它變成實作測試，而非需求測試：
   - ❌ 任何以「驗證」、「測試」、「確認」、「檢查」+ 實作行為開頭的項目
   - ❌ 參考程式碼執行、使用者動作、系統行為
   - ❌「正確顯示」、「正常運作」、「如預期運作」
   - ❌「點擊」、「導覽」、「渲染」、「載入」、「執行」
   - ❌ 測試案例、測試計畫、QA 程序
   - ❌ 實作細節（框架、API、演算法）

   **✅ 必要模式** - 這些測試需求品質：
   - ✅「是否為 [情境] 定義/指定/記錄了 [需求類型]？」
   - ✅「[模糊術語] 是否以具體標準量化/釐清？」
   - ✅「[章節 A] 和 [章節 B] 之間的需求是否一致？」
   - ✅「[需求] 是否可客觀衡量/驗證？」
   - ✅「需求中是否涵蓋了 [邊界案例/情境]？」
   - ✅「規格是否定義了 [缺失面向]？」

6. **結構參考**：依照 `.specify/templates/checklist-template.md` 中的標準模板產生檢查清單，用於標題、元資料區塊、類別標題和 ID 格式。如果模板不可用，使用：H1 標題、目的/建立日期元資料行、`##` 類別區塊，包含 `- [ ] CHK### <需求項目>` 行，並使用從 CHK001 開始的全域遞增 ID。

7. **報告**：輸出已建立檢查清單的完整路徑、項目數量，並提醒使用者每次執行都會建立新檔案。摘要：
   - 選擇的焦點領域
   - 深度等級
   - 角色/時機
   - 納入的任何明確使用者指定的必備項目

**重要**：每次 `/speckit.checklist` 指令呼叫都會使用簡短、描述性的名稱建立檢查清單檔案，除非檔案已存在。這允許：

- 不同類型的多個檢查清單（例如，`ux.md`、`test.md`、`security.md`）
- 簡單、易記的檔名，指示檢查清單目的
- 在 `checklists/` 資料夾中輕鬆識別和導覽

為避免混亂，使用描述性類型，並在完成時清理過時的檢查清單。

## 檢查清單類型與範例項目

**UX 需求品質：** `ux.md`

範例項目（測試需求，而非實作）：

- 「視覺層級需求是否以可衡量的標準定義？[清晰度, Spec §FR-1]」
- 「UI 元素的數量和定位是否明確指定？[完整性, Spec §FR-1]」
- 「所有互動元素的互動狀態需求（懸停、焦點、啟用）是否一致定義？[一致性]」
- 「是否為所有互動元素指定了無障礙需求？[覆蓋範圍, Gap]」
- 「是否定義了當圖片載入失敗時的後備行為？[邊界案例, Gap]」
- 「『顯眼顯示』是否可客觀衡量？[可衡量性, Spec §FR-4]」

**API 需求品質：** `api.md`

範例項目：

- 「是否為所有失敗情境指定了錯誤回應格式？[完整性]」
- 「速率限制需求是否以具體門檻量化？[清晰度]」
- 「所有端點的驗證需求是否一致？[一致性]」
- 「是否定義了外部相依性的重試/逾時需求？[覆蓋範圍, Gap]」
- 「需求中是否記錄了版本控制策略？[Gap]」

**效能需求品質：** `performance.md`

範例項目：

- 「效能需求是否以具體指標量化？[清晰度]」
- 「是否為所有關鍵使用者旅程定義了效能目標？[覆蓋範圍]」
- 「是否指定了不同負載條件下的效能需求？[完整性]」
- 「效能需求是否可客觀衡量？[可衡量性]」
- 「是否定義了高負載情境的降級需求？[邊界案例, Gap]」

**安全性需求品質：** `security.md`

範例項目：

- 「是否為所有受保護資源指定了驗證需求？[覆蓋範圍]」
- 「是否定義了敏感資訊的資料保護需求？[完整性]」
- 「威脅模型是否已記錄，且需求是否與其對齊？[可追溯性]」
- 「安全性需求是否與合規義務一致？[一致性]」
- 「是否定義了安全失敗/洩漏回應需求？[Gap, 例外流程]」

## 反面範例：不要這樣做

**❌ 錯誤 - 這些測試實作，而非需求：**

```markdown
- [ ] CHK001 - 驗證登陸頁面顯示 3 張節目卡片 [Spec §FR-001]
- [ ] CHK002 - 測試桌面上的懸停狀態是否正確運作 [Spec §FR-003]
- [ ] CHK003 - 確認點擊 logo 會導覽到首頁 [Spec §FR-010]
- [ ] CHK004 - 檢查相關節目區塊是否顯示 3-5 個項目 [Spec §FR-005]
```

**✅ 正確 - 這些測試需求品質：**

```markdown
- [ ] CHK001 - 是否明確指定了精選節目的數量和佈局？[完整性, Spec §FR-001]
- [ ] CHK002 - 所有互動元素的懸停狀態需求是否一致定義？[一致性, Spec §FR-003]
- [ ] CHK003 - 所有可點擊品牌元素的導覽需求是否清晰？[清晰度, Spec §FR-010]
- [ ] CHK004 - 相關節目的選擇標準是否已記錄？[Gap, Spec §FR-005]
- [ ] CHK005 - 是否定義了非同步節目資料的載入狀態需求？[Gap]
- [ ] CHK006 - 「視覺層級」需求是否可客觀衡量？[可衡量性, Spec §FR-001]
```

**關鍵差異：**

- 錯誤：測試系統是否正確運作
- 正確：測試需求是否正確撰寫
- 錯誤：驗證行為
- 正確：驗證需求品質
- 錯誤：「它是否做 X？」
- 正確：「X 是否清楚指定？」
