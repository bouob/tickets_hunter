---
description: "根據可用的設計產物，為該功能產生一份可執行、依相依性（dependency）排序的 tasks.md。"
model: opus
handoffs:
  - label: Analyze For Consistency
    agent: speckit.analyze
    prompt: Run a project analysis for consistency
    send: true
  - label: Implement Project
    agent: speckit.implement
    prompt: Start the implementation in phases
    send: true
---

## 使用者輸入

```text
$ARGUMENTS
```

您 **必須** 在繼續之前考量使用者輸入（如非空白）。

## 大綱

1. **設定**：從儲存庫根目錄執行 `.specify/scripts/powershell/check-prerequisites.ps1 -Json`，並解析 FEATURE_DIR 和 AVAILABLE_DOCS 清單。所有路徑必須為絕對路徑。對於參數中的單引號（如 "I'm Groot"），使用跳脫語法：例如 'I'\''m Groot'（或盡可能使用雙引號："I'm Groot"）。

2. **載入設計文件**：從 FEATURE_DIR 讀取：
   - **必要**：plan.md（技術堆疊、函式庫、結構）、spec.md（帶優先順序的使用者故事）
   - **可選**：data-model.md（實體）、contracts/（API 端點）、research.md（決策）、quickstart.md（測試情境）
   - 注意：並非所有專案都有所有文件。根據可用的內容產生任務。

3. **執行任務產生工作流程**：
   - 載入 plan.md 並擷取技術堆疊、函式庫、專案結構
   - 載入 spec.md 並擷取帶優先順序的使用者故事（P1、P2、P3 等）
   - 如果 data-model.md 存在：擷取實體並對應到使用者故事
   - 如果 contracts/ 存在：對應端點到使用者故事
   - 如果 research.md 存在：擷取設定任務的決策
   - 產生按使用者故事組織的任務（參見下方任務產生規則）
   - 產生顯示使用者故事完成順序的相依性圖
   - 為每個使用者故事建立平行執行範例
   - 驗證任務完整性（每個使用者故事有所有需要的任務、可獨立測試）

4. **產生 tasks.md**：使用 `.specify/templates/tasks-template.md` 作為結構，填入：
   - 來自 plan.md 的正確功能名稱
   - 階段 1：設定任務（專案初始化）
   - 階段 2：基礎任務（所有使用者故事的阻擋先決條件）
   - 階段 3+：每個使用者故事一個階段（按 spec.md 的優先順序排列）
   - 每個階段包括：故事目標、獨立測試標準、測試（如有要求）、實作任務
   - 最終階段：收尾與跨領域關注點
   - 所有任務必須遵循嚴格的檢查清單格式（參見下方任務產生規則）
   - 每個任務的清楚檔案路徑
   - 顯示故事完成順序的相依性區塊
   - 每個故事的平行執行範例
   - 實作策略區塊（MVP 優先、增量交付）

5. **報告**：輸出產生的 tasks.md 路徑和摘要：
   - 總任務數
   - 每個使用者故事的任務數
   - 識別的平行機會
   - 每個故事的獨立測試標準
   - 建議的 MVP 範圍（通常只有使用者故事 1）
   - 格式驗證：確認所有任務都遵循檢查清單格式（核取方塊、ID、標籤、檔案路徑）

任務產生的環境：$ARGUMENTS

tasks.md 應該立即可執行——每個任務必須足夠具體，讓 LLM 可以在沒有額外環境的情況下完成它。

## 任務產生規則

**關鍵**：任務必須按使用者故事組織，以實現獨立實作和測試。

**測試是可選的**：僅在功能規格中明確要求或使用者要求 TDD 方法時才產生測試任務。

### 檢查清單格式（必要）

每個任務必須嚴格遵循此格式：

```text
- [ ] [TaskID] [P?] [Story?] 描述和檔案路徑
```

**格式元件**：

1. **核取方塊**：始終以 `- [ ]`（Markdown 核取方塊）開頭
2. **任務 ID**：按執行順序的循序編號（T001、T002、T003...）
3. **[P] 標記**：僅在任務可平行化時包含（不同檔案、不依賴未完成的任務）
4. **[Story] 標籤**：僅用於使用者故事階段任務，為必要
   - 格式：[US1]、[US2]、[US3] 等（對應到 spec.md 的使用者故事）
   - 設定階段：無故事標籤
   - 基礎階段：無故事標籤
   - 使用者故事階段：必須有故事標籤
   - 收尾階段：無故事標籤
5. **描述**：清楚的動作和確切的檔案路徑

**範例**：

- ✅ 正確：`- [ ] T001 依實作計畫建立專案結構`
- ✅ 正確：`- [ ] T005 [P] 在 src/middleware/auth.py 實作驗證中介軟體`
- ✅ 正確：`- [ ] T012 [P] [US1] 在 src/models/user.py 建立 User 模型`
- ✅ 正確：`- [ ] T014 [US1] 在 src/services/user_service.py 實作 UserService`
- ❌ 錯誤：`- [ ] 建立 User 模型`（缺少 ID 和故事標籤）
- ❌ 錯誤：`T001 [US1] 建立模型`（缺少核取方塊）
- ❌ 錯誤：`- [ ] [US1] 建立 User 模型`（缺少任務 ID）
- ❌ 錯誤：`- [ ] T001 [US1] 建立模型`（缺少檔案路徑）

### 任務組織

1. **從使用者故事（spec.md）** - 主要組織：
   - 每個使用者故事（P1、P2、P3...）有自己的階段
   - 將所有相關元件對應到其故事：
     - 該故事需要的模型
     - 該故事需要的服務
     - 該故事需要的端點/UI
     - 如果要求測試：該故事特定的測試
   - 標記故事相依性（大多數故事應該是獨立的）

2. **從契約**：
   - 將每個契約/端點對應到它服務的使用者故事
   - 如果要求測試：在該故事階段中，每個契約 → 契約測試任務 [P] 在實作之前

3. **從資料模型**：
   - 將每個實體對應到需要它的使用者故事
   - 如果實體服務多個故事：放在最早的故事或設定階段
   - 關係 → 在適當故事階段的服務層任務

4. **從設定/基礎設施**：
   - 共享基礎設施 → 設定階段（階段 1）
   - 基礎/阻擋任務 → 基礎階段（階段 2）
   - 故事特定設定 → 在該故事的階段內

### 階段結構

- **階段 1**：設定（專案初始化）
- **階段 2**：基礎（阻擋先決條件——必須在使用者故事之前完成）
- **階段 3+**：按優先順序排列的使用者故事（P1、P2、P3...）
  - 每個故事內：測試（如有要求）→ 模型 → 服務 → 端點 → 整合
  - 每個階段應該是完整的、可獨立測試的增量
- **最終階段**：收尾與跨領域關注點
