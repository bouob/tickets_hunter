# settings.json 詳細設定說明

本文件詳細說明在圖形介面中看到的各項設定欄位。

---

## 📚 目錄

1. [設定方式](#設定方式)
2. [基礎設定](#基礎設定)
3. [日期選擇設定](#日期選擇設定)
4. [區域選擇設定](#區域選擇設定)
5. [驗證碼設定](#驗證碼設定)
6. [平台特定設定](#平台特定設定)
7. [進階設定](#進階設定)

---

## 設定方式

### 推薦方式：使用圖形介面

**網頁介面（推薦）**：
```bash
cd tickets_hunter/src
python settings.py
```
瀏覽器會自動開啟：`http://127.0.0.1:16888/`

**桌面介面**：
```bash
cd tickets_hunter/src
python settings_old.py
```

在圖形介面中，您可以直接透過中文欄位名稱進行設定，無需手動編輯 JSON 檔案。

---

## 基礎設定

### 售票網站（homepage）
**必填** | 類型：字串

活動或票券的網址。


**支援平台**：
- TixCraft: `https://tixcraft.com/...`
- KKTIX: `https://kktix.com/events/...`
- TicketPlus: `https://ticketplus.com.tw/...`
- iBon: `https://ticket.ibon.com.tw/...`
- 其他支援平台

**提示**：直接複製活動頁面網址即可。

---

### 瀏覽器（browser）
選填 | 類型：字串 | 預設：chrome

指定使用的瀏覽器。


**可選值**：
- chrome - Google Chrome（**推薦**）
- firefox - Mozilla Firefox
- edge - Microsoft Edge
- safari - Safari（macOS）
- brave - Brave 瀏覽器


---

### WebDriver類別（webdriver_type）
**重要** | 類型：字串 | 預設：nodriver

選擇搶票引擎類型。


**可選值**：

- Nodriver - **推薦（需 Python 3.9+）**
- Undetected Chromedriver - 舊版回退選項
- Selenium


**平台支援狀態**：
- **TixCraft / KKTIX / TicketPlus / KHAM / 年代**：NoDriver ✅ 完全支援
- **iBon**：僅 NoDriver 支援（Chrome 版本不修復）
- **Cityline / Urbtix**：建議使用 Chrome 版本，等待重構

---

### 語言（language）
選填 | 類型：字串 | 預設：English

圖形介面語言設定。


**可選值**：
- 繁體中文
- English
- 日本語

---

### 門票張數（ticket_number）
**必填** | 類型：整數 | 預設：2

要購買的票數。


**注意**：
- 請遵守活動規定（通常限制 1-4 張）
- 超過限制可能導致購票失敗

---

### 刷新在指定時間（refresh_datetime）
選填 | 類型：字串 | 預設：空白

指定時間自動重整頁面開始搶票。


**格式**：HH:MM:SS（24小時制）

**範例值**：14:00:00

**使用情境**：
- 已知演唱會下午2點開賣
- 提前開啟程式並導航到售票頁面
- 程式會在 14:00:00 自動重整頁面並開始搶票

**停用**：留空即可

---

## 日期選擇設定

### 日期自動點選（date_auto_select）

#### 啟用（enable）
類型：布林值 | 預設：啟用

是否啟用日期自動選擇功能。


**說明**：
- 啟用 - 自動選擇日期
- 停用 - 等待手動選擇

---

#### 日期關鍵字（date_keyword）
類型：字串 | 預設：空白

指定要選擇的日期的部分文字。


**格式說明**：
- 多組關鍵字用分號分隔（OR 邏輯）
- 關鍵字內部用空格表示 AND 邏輯
- 逗號只是文字的一部分（例如價格 "3,280"）

**進階用法**：

| 需求 | 設定範例 | 說明 |
|------|---------|------|
| 單一日期 | 11/16 | 包含「11/16」的選項 |
| 多組日期（OR） | 11/16;11/17;11/18 | 三個日期任一命中即可 |
| 指定星期 | 週六;週日 | 週六或週日任一命中 |
| 指定時間 | 19:30;晚上 | 包含「19:30」或「晚上」 |
| 空格 AND | 11/16 上午 | 必須同時包含「11/16」和「上午」 |
| 組合 | 11/16 上午;11/16 下午 | 先找「11/16 上午」，找不到再找「11/16 下午」 |
| 不指定 | 留空 | 使用日期排序方式自動選 |

**詳細說明**：參考 [關鍵字與回退機制](keyword-mechanism.md#日期關鍵字機制)

---

#### 日期排序方式（mode）
類型：字串 | 預設：random

當關鍵字找不到時的自動選擇策略。


**可選值**：

| 值 | 中文說明 | 適用情境 |
|---|---------|---------|
| from top to bottom | 從上到下 | 選最早場次 |
| from bottom to top | 從下到上 | 選最晚場次 |
| center | 中間 | 平衡策略 |
| random | 隨機 | 增加變化性（預設） |

---

## 區域選擇設定

### 區域自動點選（area_auto_select）

#### 啟用（enable）
類型：布林值 | 預設：啟用

是否啟用區域自動選擇功能。


---

#### 區域關鍵字（area_keyword）
類型：字串 | 預設：空白

指定要選擇的區域的部分文字。


**格式說明**：
- 多組關鍵字用分號分隔（OR 邏輯）
- 關鍵字內部用空格表示 AND 邏輯
- 逗號只是文字的一部分（例如價格 "3,280"）

**進階用法**：

| 需求 | 設定範例 | 說明 |
|------|---------|------|
| 單一區域 | 搖滾A | 包含「搖滾A」的選項 |
| 多組區域（OR） | 搖滾A;搖滾B;VIP | 三個區域任一命中即可 |
| 用票價選 | 3,280;2,680 | 包含「3,280」或「2,680」 |
| 用位置選 | 前排;中央 | 包含「前排」或「中央」 |
| 空格 AND | 搖滾A 前排 | 必須同時包含「搖滾A」和「前排」 |
| 組合 | 搖滾A 3,280;搖滾B 2,680 | 先找「搖滾A 3,280」，找不到再找「搖滾B 2,680」 |
| 不指定 | 留空 | 使用區域排序方式自動選 |

**詳細說明**：參考 [關鍵字與回退機制](keyword-mechanism.md#區域關鍵字機制)

---

#### 區域排序方式（mode）
類型：字串 | 預設：random

當關鍵字找不到時的自動選擇策略。


**可選值**：

| 值 | 中文說明 | 適用情境 |
|---|---------|---------|
| from top to bottom | 從上到下 | 選最貴/最好位置（通常） |
| from bottom to top | 從下到上 | 選最便宜位置 |
| center | 中間 | 中等價位 |
| random | 隨機 | 分散風險（預設） |

---

### 排除關鍵字（keyword_exclude）
**重要** | 類型：字串 | 預設：輪椅;身障;身心;障礙;Restricted View;燈柱遮蔽;視線不完整

設定**不要選擇**包含這些文字的區域。


**說明**：
- 避免誤選輪椅席（通常需特殊資格）
- 避免選到視線受阻的區域

**使用提示**（在圖形介面中會看到）：
- 關鍵字用分號分隔（如：輪椅;不良）
- 關鍵字內有空格表示 AND 邏輯（如：VIP 包廂）
- 支援引號格式，但非必需

---

## 驗證碼設定

### 猜測驗證碼（ocr_captcha）

#### 啟用（enable）
類型：布林值 | 預設：啟用

是否啟用 OCR 自動辨識驗證碼。


**說明**：
- 啟用 - 自動 OCR 辨識驗證碼
- 停用 - 等待手動輸入

---

#### ddddocr beta（beta）
類型：布林值 | 預設：啟用

是否使用 beta OCR 模型。


**說明**：
- 啟用 - 使用 beta 模型
- 停用 - 使用標準模型

---

#### 掛機模式（force_submit）
類型：布林值 | 預設：啟用

辨識後是否自動送出表單。


**說明**：
- 啟用 - 辨識後自動送出（快速模式，完全掛機）
- 停用 - 辨識後等待手動確認（安全模式）

**建議**：
- 信任 OCR：啟用
- 希望確認：停用

---

#### OCR圖片取得方式（image_source）
類型：字串 | 預設：canvas

驗證碼圖片的來源類型。


**可選值**：
- canvas - 從 Canvas 元素擷取
- img - 從 img 標籤擷取

---

## 平台特定設定

### TixCraft（拓元售票）

#### 避開「搶購一空」的日期（pass_date_is_sold_out）
類型：布林值 | 預設：啟用

是否自動跳過已售完的日期。


**說明**：
- 啟用 - 自動過濾售完日期
- 停用 - 包含售完日期

---

#### 自動刷新倒數中的日期頁面（auto_reload_coming_soon_page）
類型：布林值 | 預設：啟用

遇到「即將開賣」頁面時是否自動重載。


**說明**：
- 啟用 - 自動重載等待開賣
- 停用 - 不重載

---

### KKTIX

#### KKTIX點選下一步按鈕（auto_press_next_step_button）
類型：布林值 | 預設：true勾選

是否自動點擊「下一步」按鈕。


---

#### 自動輸入張數（auto_fill_ticket_number）
類型：布林值 | 預設：啟用

是否自動填寫票數（KKTIX 價格清單式票種）。


---

#### KKTIX購票最長停留(秒)（max_dwell_time）
類型：整數 | 預設：90

在訂單頁面的最大停留時間（秒）。


**說明**：超過此時間會自動送出訂單（避免逾時）。

---

### Cityline（Cityline 買飛）

#### cityline queue retry
類型：布林值 | 預設：啟用

排隊失敗時是否自動重試。


---

## 進階設定

**在圖形介面中，這些設定位於「進階設定」頁籤**

### 輸出詳細除錯訊息（verbose）
類型：布林值 | 預設：停用

是否顯示詳細的執行過程訊息。


**說明**：
- 啟用 - 顯示詳細日誌
- 停用 - 僅顯示關鍵訊息


**警告**：輸出大量日誌可能影響搶票效能，除非需要除錯，否則建議保持關閉。

---

### 無圖形界面模式（headless）
類型：布林值 | 預設：停用

是否使用無頭模式（不顯示瀏覽器視窗）。


**說明**：
- 啟用 - 背景執行，不顯示瀏覽器
- 停用 - 顯示瀏覽器視窗

**建議**：保持停用，方便觀察執行過程

---

### 瀏覽器視窗大小（window_size）
類型：字串 | 預設：600,1024

瀏覽器視窗大小。


**格式**：寬度,高度

---

### Chrome 瀏覽器擴充功能（chrome_extension）
類型：布林值 | 預設：停用

是否載入 Chrome 擴充功能


**說明**：
- 啟用 - 載入擴充功能
- 停用 - 不載入

---

### 自動刷新頁面間隔(秒)（auto_reload_page_interval）
類型：浮點數 | 預設：5.0

自動重載頁面的間隔時間（秒）。


**說明**：較小的值會更頻繁重載，但可能觸發過熱保護。

---

### 音效通知

#### 有票時播放音效（play_sound.ticket）
類型：布林值 | 預設：啟用

選到票時是否播放音效。


---

#### 訂購時播放音效（play_sound.order）
類型：布林值 | 預設：啟用

送出訂單時是否播放音效。


---

#### 音效檔（play_sound.filename）
類型：字串 | 預設：assets/sounds/ding-dong.wav

音效檔案路徑。


---

### Cookie 設定（快速登入）

#### 拓元家族 cookie SID（tixcraft_sid）
類型：字串 | 預設：空白

拓元售票的 Cookie SID，用於快速登入。


**取得方式**：
1. 在拓元網站登入
2. 開啟瀏覽器開發者工具（F12）
3. Application → Cookies → 找到 `SID`
4. 複製值並填入

---

#### ibon cookie ibonqware（ibonqware）
類型：字串 | 預設：空白

iBon 的 Cookie qware，用於快速登入。


**取得方式**：
1. 在 iBon 網站登入
2. 開啟瀏覽器開發者工具（F12）
3. Application → Cookies → 找到 `qware`
4. 複製值並填入

---

### 帳號密碼設定

支援多個平台的帳號密碼設定：

| 平台 | 帳號欄位 | 密碼欄位 | 圖形介面顯示 |
|------|---------|---------|-------------|
| KKTIX | kktix_account | kktix_password | KKTIX 帳號 / KKTIX 密碼 |
| TicketPlus | ticketplus_account | ticketplus_password | 遠大 帳號 / 遠大 密碼 |
| KHAM | kham_account | kham_password | 寬宏 帳號 / 寬宏 密碼 |
| Cityline | cityline_account | cityline_password | cityline 帳號 / cityline 密碼 |
| 年代 | ticket_account | ticket_password | 年代 帳號 / 年代 密碼 |
| Urbtix | urbtix_account | urbtix_password | URBTIX 帳號 / URBTIX 密碼 |
| HKTicketing | hkticketing_account | hkticketing_password | HKTICKETING 帳號 / HKTICKETING 密碼 |
| FamiTicket | fami_account | fami_password | FamiTicket 帳號 / FamiTicket 密碼 |
| Facebook | facebook_account | facebook_password | Facebook 帳號 / Facebook 密碼 |
| UDN | udn_account | udn_password | UDN 帳號 / UDN 密碼 |

**注意**：
- 明文密碼有安全風險，建議使用 Cookie 登入
- 密碼會以明文儲存在 settings.json
- 圖形介面會顯示警告：`將密碼保存到設定檔中可能會讓您的密碼被盜。`

---

## 💡 設定建議

### 建議 1：新手推薦設定
- **WebDriver類別**：nodriver
- **日期排序方式**：from top to bottom（選最早場次）
- **區域排序方式**：from top to bottom（選最好位置）
- **排除關鍵字**：務必設定（避免誤選輪椅席）
- **輸出詳細除錯訊息**：關閉（避免影響效能，除非需要除錯）

---

### 建議 2：進階使用者
- 使用多組關鍵字提高成功率
- 善用 AND 邏輯精確匹配（分號分隔）
- 啟用音效通知（有票時/訂購時）

---

### 建議 3：測試設定
正式開搶前，用其他活動測試設定：
1. 填寫一個可用的活動網址
2. 設定關鍵字與參數
3. 啟動程式觀察執行過程
4. 根據詳細輸出調整設定

---

## ❓ 常見問題

### Q1: 圖形介面和 settings.json 哪個優先？  
**A:** 圖形介面修改後會自動儲存到 settings.json。
---

### Q2: 修改設定後要重新啟動嗎？
**A:** 是的，修改後需要重新啟動搶票程式才會生效。

---

### Q3: 可以同時用多個設定檔嗎？
**A:** 可以！使用 config_launcher.py 管理多個設定檔：
- 在 tickets_hunter/src 目錄執行 python config_launcher.py

---

### Q4: 可以備份設定檔嗎？
**A:** 可以！複製 settings.json 並改名即可備份。

---

### Q5: 系統支援哪些語言？

**A:** 系統針對不同功能提供多語言支援：

#### 完整多語言支援（繁體中文、英文、日文）
- 「尚未開賣」偵測：支援「尚未開賣」、「Not Started」、「まだ発売」
- 「即將開賣」偵測：支援「即將開賣」、「Coming Soon」
- 「售完」偵測：支援「已售完」、「Sold Out」

#### 範例
- 關鍵字設定「週六 19:30」（繁體中文）

---

## 📚 延伸閱讀

- [快速入門指南](quick-start.md) - 第一次使用設定
- [關鍵字與回退機制](keyword-mechanism.md) - 深入了解關鍵字邏輯
- [使用者手冊首頁](README.md) - 回到總覽

---

**祝您搶票成功！** 🎉

*最後更新：2025-10-29 | 版本：1.2*
